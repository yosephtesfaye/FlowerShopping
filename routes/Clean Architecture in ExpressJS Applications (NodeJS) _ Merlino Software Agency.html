<!DOCTYPE html>
<!-- saved from url=(0073)https://merlino.agency/blog/clean-architecture-in-express-js-applications -->
<html lang="en" class="scroll-smooth"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width"><title>Clean Architecture in ExpressJS Applications (NodeJS) | Merlino Software Agency</title><meta property="robots" content="index,follow"><meta property="googlebot" content="index,follow"><meta property="description" content="I can&#39;t emphasize enough how learning and implementing the Clean Architecture in all our projects has saved—and is saving—us so much time in the developmen..."><meta property="keywords" content="clean-architecture, express, javascript, nodejs, software-architecture, software-engineering"><meta property="og:type" content="website"><meta property="og:title" content="Clean Architecture in ExpressJS Applications (NodeJS) | Merlino Software Agency"><meta property="og:description" content="I can&#39;t emphasize enough how learning and implementing the Clean Architecture in all our projects has saved—and is saving—us so much time in the developmen..."><meta property="og:site_name" content="Merlino Software Agency"><meta property="og:type" content="website"><meta property="og:image" content="https://images.ctfassets.net/vsall43tabcn/2RZOrhQVLoPVOPT3sgV2Lf/68eaf4602453e37a7eedccc520ca2981/Clean_Architecture_in_ExpressJS_Applications.png"><meta property="og:image:width" content="1600"><meta property="og:image:height" content="960"><meta property="og:image:alt" content="Clean Architecture in ExpressJS Applications (NodeJS) | Merlino Software Agency"><meta property="og:url" content="https://merlino.agency/blog/clean-architecture-in-express-js-applications"><link rel="canonical" href="https://merlino.agency/blog/clean-architecture-in-express-js-applications"><meta name="twitter:title" content="Clean Architecture in ExpressJS Applications (NodeJS) | Merlino Software Agency"><meta name="twitter:description" content="I can&#39;t emphasize enough how learning and implementing the Clean Architecture in all our projects has saved—and is saving—us so much time in the developmen..."><meta name="twitter:image:src" content="https://images.ctfassets.net/vsall43tabcn/2RZOrhQVLoPVOPT3sgV2Lf/68eaf4602453e37a7eedccc520ca2981/Clean_Architecture_in_ExpressJS_Applications.png"><meta name="twitter:card" content="summary_large_image"><script type="text/javascript" async="" src="./Clean Architecture in ExpressJS Applications (NodeJS) _ Merlino Software Agency_files/js"></script><script type="text/javascript" async="" src="./Clean Architecture in ExpressJS Applications (NodeJS) _ Merlino Software Agency_files/analytics.js.download"></script><script async="" src="./Clean Architecture in ExpressJS Applications (NodeJS) _ Merlino Software Agency_files/gtm.js.download"></script><script type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Blog","item":"https://merlino.agency/blog"},{"@type":"ListItem","position":2,"name":"Clean Architecture in ExpressJS Applications (NodeJS)","item":"https://merlino.agency/blog/clean-architecture-in-express-js-applications"}]}</script><script type="application/ld+json">{"@context":"https://schema.org/","@type":"BlogPosting","name":"Clean Architecture in ExpressJS Applications (NodeJS)","articleBody":"I can't emphasize enough how learning and implementing the Clean Architecture in all our projects has saved—and is saving—us so much time in the development of new features, the testability of the system, and the general maintenance of their components. Implementing it will require a little effort in understanding how it works and will also generate a bit more files than just following, for example, the ExpressJS Getting Started guide. However, we will never go back. It served us so robustly that we'll just keep focusing on shipping. Now, let's start.  Introduction The secret to building a large project that is easy to maintain and performs better is to separate files and classes into components that can change independently without affecting other components: this is what Clean Architecture is all about. Clean Architecture is an architectural style created by Robert C. Martin. It is a set of standards that aims to develop an application that makes it easier to quality code that will perform better, is easy to maintain, and has fewer dependencies as the project grows. Firstly, I will introduce what Clean Architecture is. We will then head to the development side of things to see how the engineering team at Merlino Software Agency developed OneFood and Isla using NodeJS/ExpressJS with a Clean Architecture. In the end, we will conclude how Clean Architecture makes a difference. According to Stack Overflow Insights of 2021, JavaScript completes its ninth year in a row as the most commonly used programming language. NodeJS is placed as the sixth most widely used tool, and Express JS, a minimal Node JS framework, got the third position as the most common web framework. Therefore, having your application in Express JS decorated with Clean Architecture is a blessing that leads to better performance and easy maintainability of the project. Let us have a quick introduction to Software Architecture before diving into it! What is Software Architecture Before providing a definition, consider that the actions people may do using systems on a daily basis — scheduling a Tweet to post, sending an automated transactional email, etc. — heavily depend on the Software Architecture of the system in use. Many things we know and use would be impossible without software architecture, but why is that? A system's architecture acts as a blueprint. It establishes a communication and coordination mechanism among components, gives an abstraction to control system complexity, and represents the design decisions related to overall system structure and behavior. In simple words, Software Architecture exposes a system's structure while hiding implementation details. Moreover, it also focuses on how the elements and components within a system interact with one another. The subject of Software Architecture appears to have sparked much attention in recent years. Furthermore, among the many different types and styles, Clean Architecture attracted more attention than the others. Let us head to the central part of the article and find out what Clean Architecture is. The Clean Architecture Microservices and serverless architecture have emerged as revolutionary architectural patterns in the software development world during the last several years. Each has its characteristics, behaviors, technological structure, and required expertise. However, they are all part of a broader desire for a better separation of architecture concerns and improved testability. Clean Architecture is a set of standards that aims to develop layered architectures that make it easier to write quality code that will perform better, is easy to maintain, and has fewer dependencies as the project grows. This architecture can be applied no matter what language you code in. The illustration below shows the four concentric circles that compose a Clean Architecture, how they interact with each other, and their dependencies. The Dependency Rule In the illustration above, please pay attention to the arrows, the fact that they are pointing from the outermost circle down into the innermost circle, and that they only go in one direction. The arrows represent the dependence flow, indicating that an outer ring can depend on an inner ring but that an inner ring cannot rely on an outer ring; this is what The Dependency Rule is all about. For example, Entities know nothing about all the other circles, while the Frameworks & Drivers, the outer layer, know everything about the inner rings. In simple words, variables, functions, classes, or any other named software entity declared in an outer circle must not be mentioned by the code in an inner circle. Four layers of Clean Architecture There are four concentric circles in Clean Architecture that each represents different areas of Software, which are as below: Entities Use Cases Interface Adapters Frameworks and Drivers The development team of Merlino also implemented another layer called Routes, and that's totally okay. If you find that you may need more than four, just go on. However, the Dependency Rule must always apply. So, the four layers become five layers in our case study, which are as below: Entities (Mongoose models and their abstraction) Use Cases Interface Adapters (Controllers) Routes Frameworks and Drivers Let us find out what each circle means along with our case study, but before diving in, here is the project's hierarchy; ```plaintext\n.\n│   README.md\n│   package.json  \n│   ...   \n│\n└─── app\n│   │   app.js // 5. Framework and Drivers\n│   │   server.js // start master and forks other workers\n│   │   config.js // get config from env or config file\n│   │   database.js\n│   │   logger.js\n│   │\n│   └─── models // 1.a) entities (i.e., Mongoose models)\n│   │   │   index.js\n│   │   │   orders.model.js\n│   │   │   ...\n│   │\n│   └─── data-access // 1.b) entities (i.e., abstraction of Mongoose models)\n│   │   │   index.js\n│   │   │   orders.db.js\n│   │   │   ...\n│   │\n│   └─── use-cases // 2) Use cases\n│   │   └─── orders\n│   │   │   │   index.js\n│   │   │   │   post-order.js\n│   │   │   │   ...\n│   │   └─── ...\n│   │\n│   └─── controllers // 3) Interface Adapters\n│   │   │   order.controller.js\n│   │   │   ...\n│   │\n│   └─── routes // 4) Routes\n│   │   │   order.routes.js\n│   │   │   ...\n│   \n└─── ...\n``` 1. Entities At the center of the onion are the Entities of the software, which constitute the business logic of software. An entity can be an object with methods, or it can be a set of data structures and functions, they don't know anything about the outer layers and don't have any dependency. In simple words, Entities are the primary concepts of your business. When something external happens, Entities are the least likely to change. A change to page navigation or security, for example, would not be expected to affect these objects. The entity circle should not be affected by any operational changes to any application. If you're building a Social Media application, you might have entities like Posts, Comment, or User, or in the case of OneFood — a premium food delivery business and a client of ours — a few of their entities would be Customer, Order, Payment, Product, Vendor, etc. Important to consider is that since we use Mongoose, we'll also have model definitions, which are specific to this implementation and we'll soon see how to abstract them. All models are then exported like follows: All Entities can then be exported like this: ```javascript\n// /models/index.js\n\nimport Orders from './orders.model';\n// ...\n\nexport {\n  Orders,\n  // ...\n};\n``` Then, in `data-access`, let's create an abstraction layer that allows us to decouple the database methods that we call in our application (i.e., `findOne`, insert`, etc.) from the type of database, in this case, MongoDB. We might want to change to a SQL database in the future and that'll be totally fine. One could argue that this is what Prisma does as a service. ```javascript\n// /data-access/orders.db.js\n\n// outside libraries are ok to import\nimport {v4 as uuid} from \"uuid\";\nimport _ from \"lodash\";\n\nexport default function makeOrdersDb({Orders}) {\n  async function findOne(_filter, _options = {}) {\n    const {populate, sort} = _options;\n    const query = Orders.findOne(_filter);\n    if (sort) query.sort(sort);\n    _.forEach(populate || [], (p) => query.populate(p));\n    return query.lean().exec();\n  }\n  async function insert({id: _id = uuid(), ...orderInfo}) {\n    return Orders.create({_id, ...orderInfo});\n  }\n  async function update(_filter, _orderInfo) {\n    return Orders.findOneAndUpdate(_filter, _orderInfo, {new: true});\n  }\n  async function remove(_id) {\n    const res = await Orders.deleteOne({_id});\n    return {\n      found: res.n,\n      deleted: res.deletedCount\n    };\n  }\n  async function find(_filter, _options = {}) {\n    const {populate} = _options;\n    const query = Orders.find(_filter);\n    if (populate) _.forEach(populate || [], (p) => query.populate(p));\n    return query.lean().exec();\n  }\n  async function aggregate(pipeline = []) {\n    return Orders.aggregate(pipeline);\n  }\n  async function paginate(_query, _options) {\n    const {sort, populate, page, limit} = _options;\n    return Orders.paginate(_query, {\n      sort,\n      lean: true,\n      page,\n      limit,\n      populate\n    });\n  }\n  return Object.freeze({\n    findOne,\n    insert,\n    update,\n    remove,\n    find,\n    aggregate,\n    paginate\n  });\n}\n``` Several of these files would then be exported in their `index.js` like follows: ```javascript\n// /data-access/index.js\n\n// your DB model definitions, in OneFood's case they are Mongoose files\nimport * as models from \"../models\";\n\nimport makeOrdersDb from \"./orders.db\";\n\nconst ordersDb = makeOrdersDb(models);\n\nexport {\n  ordersDb,\n  ...\n};\n``` As you can see we are making the `models` available to their abstraction layer through Dependency Injection. Somewhere upstream, we have some code that will call the `ordersDb.findOne()` function and all the various dependencies required (i.e., `models`) will be automatically available. Dependency Injection has several advantages described below: The first advantage is Testability. By injecting dependencies, we can test our code independently of anything else. The other advantage is as the developer is writing this code, they do not need all of these dependencies to be ready. In this case, the developer can focus on the business logic of the Entity. The most important advantage of doing this is that the developer can change the implementation details of the project dependencies independently of this code. 2. Use Cases The Use Cases layer, which lies outside the Entities layer, contains login and rules related to the behavior and design of the system. In simple words, Use Cases are interactions between Entities. For example, suppose we are in our Social Media application example. In that case, we can have a Use Case like user posts, or in the OneFood application, a customer places an order. Changes to this layer should not affect the entities. Changes to externalities such as the database, user interface, or frameworks are unlikely to affect this layer. Let us check out the `/use-cases` directory and look at the Order's definition: ```javascript\n// /use-cases/orders/post-order.js\n\nexport default function makePostOrder({\n  ordersDb,\n  orderItemsDb,\n  getPromoCodeDetails\n}) {\n  return async function postOrder({body, headers, user}) {\n    \n    // Validate parameters...\n    // Create order...\n    // Create order items...\n\n    return order;\n  };\n}\n``` All Orders Use Cases can then be exported like this: ```javascript\n// /use-cases/orders/index.js\n\nimport {\n  ordersDb,\n  // ...\n} from 'data-access';\n\nimport Config from 'config';\n\nimport makePostOrder from './post-order';\n// ...\n\nconst postOrder = makePostOrder({\n  ordersDb,\n  Config,\n  // other injected dependencies ...\n});\n\n// Export a service containing all Use Cases ...\nconst orderService = Object.freeze({\n  postOrder,\n  // ...\n});\nexport default orderService;\n\n// ... and also every Use Case singularly\nexport {\n  postOrder,\n  // ...\n};\n``` 3. Interface Adapters The Interface Adapters or the Adapter layer holds the controllers, APIs, and gateways. The Interface Adapters govern the flow of communication between external components and the system's back-end. In simple words, Interface Adapters are isolating our various Use Cases from the tools that we use.  Let us look at the controllers directory and choose `OrderController` by sample to see what's going on:\n\n```javascript\n// /controllers/order.controller.js\n\nimport {\n  postOrder,\n  // ...\n} from 'use-cases/orders';\n\nimport {\n  postPaymentLink\n} from 'use-cases/payments';\n\nexport default Object.freeze({\n  postOrder: (httpRequest) => postOrder(httpRequest, postPaymentLink),\n  // ...\n});\n``` 4. Routes The `/routes` folder is where you can organize all of your different REST endpoints declarations. The file below exposes all available endpoints related to the `Orders` Entity: ```javascript\n// /routes/order.routes.js\n\nimport express from 'express';\n\nimport controller from 'controllers/api/orderController';\nimport makeExpressCallback from 'routes/make-callback';\n\nconst router = express.Router();\n\nrouter.route('/order').post(makeExpressCallback(controller.postOrder));\nrouter.route('/order/:orderId').get(makeExpressCallback(controller.getOrderById));\n// ...\n\nexport default router;\n``` Bonus: you may have noticed the `makeExpressCallback` function in the code. That is a wrapper function that: receives `req` and `res` as inputs from Express's `.post()`, `.get()`, etc. functions of each endpoint. creates a clean request object with all possible useful information needed by controllers and feeds them with it (i.e., `controller.postOrder`); handles whatever it's returned by controllers (i.e., data or errors), and replied to clients in a standardized way. Check this file out:  ```javascript\nimport * as Sentry from '@sentry/node';\n\nexport default (controller) => (req, res) => {\n  const httpRequest = {\n    body: req.body,\n    query: req.query,\n    params: req.params,\n    ip: req.ip,\n    method: req.method,\n    path: req.path,\n    user: req.user,\n    logger: req.logger,\n    source: {\n      ip: req.ip,\n      browser: req.get('User-Agent')\n    },\n    headers: {\n      'Content-Type': req.get('Content-Type'),\n      Referer: req.get('referer'),\n      'User-Agent': req.get('User-Agent')\n    }\n  };\n\n  // req.user coming from 'policies/token.js',\n  // after the JWT token is parsed\n  if (req.user) {\n    Sentry.setUser(req.user);\n  } else {\n    Sentry.configureScope((scope) => scope.setUser(null));\n  }\n\n  controller(httpRequest)\n    .then((httpResponse) => {\n      res.set('Content-Type', 'application/json');\n      res.type('json');\n      const body = {\n        success: true,\n        code: 200,\n        data: httpResponse\n      };\n      res.status(200).send(body);\n    })\n    .catch((e) => {\n      Sentry.captureException(e);\n      res.status(400).send({\n        success: false,\n        code: 400,\n        error: {\n          description: e.message\n        }\n      });\n    });\n};\n``` Then, let's export all routes: ```javascript\n// /routes/index.js\n\nimport express from 'express';\nimport token from 'policies/token';\nimport orders from './orders';\n// ...\n\nconst router = express.Router();\n\n// Bonus: you can split this /routes folder in 2: private and public.\n// In the private index.js file you would precede all routes declaration\n// with a function that checks if the authentication token is present\n// in all requests and it's valid.\nrouter.use(token);\nrouter.use(orders);\n\nexport default router;\n``` 5. Frameworks and Drivers The Frameworks and Drivers, also known as the Infrastructure Layer, is the outermost layer that provides all necessary details about frameworks, drivers, and tools such as Databases that we use to build our application. All the details of the system go in this layer. For example, in the case of the OneFood application, the engineering team used Express JS as the framework and Mongoose (MongoDB) for Node JS as the database framework. The entry point to the entire application is the `app.js` file. This is where we use the Express JS framework. You will see many `import` statements, initialization of Express server, using the `routes` middleware, and finally exporting the `app` module. ```javascript\n// app.js\n\nimport express from 'express';\nimport routes from \"routes\";\n// other imports\n\n// initialize express server\nconst app = express();\n\napp.use(\"/\", routes);\n\nexport default app;\n``` Conclusion Following these guidelines is simple and will save you from a lot of trouble in the future. By separating Software into layers and obeying the Dependency Rule, you will create Software that is more: Testable Maintainable Independent of a framework Independent of a database Independent of UI ... and independent of any other tools and drivers Keep in mind that there's no boundary of having just four circles/layers. If you find that you may need more than four, just go on. However, the Dependency Rule must always apply.","articleSection":"Introduction, What is Software Architecture, The Clean Architecture, The Dependency Rule, Four layers of Clean Architecture, 1. Entities, 2. Use Cases, 3. Interface Adapters, 4. Routes, 5. Frameworks and Drivers, Conclusion","wordCount":2452,"author":{"@type":"Person","url":"https://merlino.agency/author/hassib-moddasser","name":"Hassib Moddasser"},"copyrightHolder":{"@id":"https://merlino.agency/#organization"},"copyrightYear":2021,"datePublished":"2021-12-12T10:17:20.582Z","dateModified":"2022-12-06T16:19:51.472Z","discussionUrl":"https://merlino.agency/blog/clean-architecture-in-express-js-applications#comments","editor":{"@id":"https://merlino.agency/author/hassib-moddasser#author"},"headline":"Clean Architecture in ExpressJS Applications (NodeJS)","image":"https://merlino.agency/images/merlino-banner.png","inLanguage":"English","mainEntityOfPage":"https://merlino.agency/blog/clean-architecture-in-express-js-applications","publisher":{"@id":"https://merlino.agency/#organization","@type":"Organization","name":"Merlino Software Agency","logo":{"@type":"ImageObject","url":"https://merlino.agency/images/publisher-logo-rich-cards.png"}},"sourceOrganization":{"@id":"https://merlino.agency/#organization","type":"Organization","name":"Merlino Software Agency","logo":{"@type":"ImageObject","name":"Merlino Software Agency Logo","width":"230","height":"67","url":"https://merlino.agency/images/publisher-logo-rich-cards.png"}},"url":"https://merlino.agency/blog/clean-architecture-in-express-js-applications"}</script><meta name="next-head-count" content="25"><script async="" defer="" data-domain="merlino.agency" src="./Clean Architecture in ExpressJS Applications (NodeJS) _ Merlino Software Agency_files/plausible.js.download"></script><link rel="apple-touch-icon" sizes="180x180" href="https://merlino.agency/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://merlino.agency/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://merlino.agency/favicons/favicon-16x16.png"><link rel="manifest" href="https://merlino.agency/favicons/site.webmanifest"><link rel="mask-icon" href="https://merlino.agency/favicons/safari-pinned-tab.svg" color="#b00d23"><meta name="msapplication-TileColor" content="#ffffff"><meta name="theme-color" content="#b00d23"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Organization","url":"https://merlino.agency","logo":"https://merlino.agency/favicons/apple-touch-icon.png"}</script><link rel="preload" href="./Clean Architecture in ExpressJS Applications (NodeJS) _ Merlino Software Agency_files/bac393b4784b22d9.css" as="style"><link rel="stylesheet" href="./Clean Architecture in ExpressJS Applications (NodeJS) _ Merlino Software Agency_files/bac393b4784b22d9.css" data-n-g=""><link rel="preload" href="./Clean Architecture in ExpressJS Applications (NodeJS) _ Merlino Software Agency_files/ad4b3fbab81afe19.css" as="style"><link rel="stylesheet" href="./Clean Architecture in ExpressJS Applications (NodeJS) _ Merlino Software Agency_files/ad4b3fbab81afe19.css" data-n-p=""><link rel="preload" href="./Clean Architecture in ExpressJS Applications (NodeJS) _ Merlino Software Agency_files/169401a5bce4d29f.css" as="style"><link rel="stylesheet" href="./Clean Architecture in ExpressJS Applications (NodeJS) _ Merlino Software Agency_files/169401a5bce4d29f.css" data-n-p=""><noscript data-n-css=""></noscript><script defer="" nomodule="" src="./Clean Architecture in ExpressJS Applications (NodeJS) _ Merlino Software Agency_files/polyfills-c67a75d1b6f99dc8.js.download"></script><script defer="" src="./Clean Architecture in ExpressJS Applications (NodeJS) _ Merlino Software Agency_files/944.e81b6988035c32ea.js.download"></script><script src="./Clean Architecture in ExpressJS Applications (NodeJS) _ Merlino Software Agency_files/webpack-2a49aca44dcbee26.js.download" defer=""></script><script src="./Clean Architecture in ExpressJS Applications (NodeJS) _ Merlino Software Agency_files/framework-654b6047e3d0e6e1.js.download" defer=""></script><script src="./Clean Architecture in ExpressJS Applications (NodeJS) _ Merlino Software Agency_files/main-80afb05fdbafd27c.js.download" defer=""></script><script src="./Clean Architecture in ExpressJS Applications (NodeJS) _ Merlino Software Agency_files/_app-2c945bc918bfe2cd.js.download" defer=""></script><script src="./Clean Architecture in ExpressJS Applications (NodeJS) _ Merlino Software Agency_files/29107295-d9913c73c0e6adaf.js.download" defer=""></script><script src="./Clean Architecture in ExpressJS Applications (NodeJS) _ Merlino Software Agency_files/664-7b78c01f26338b43.js.download" defer=""></script><script src="./Clean Architecture in ExpressJS Applications (NodeJS) _ Merlino Software Agency_files/959-b9e00906f1a79aa2.js.download" defer=""></script><script src="./Clean Architecture in ExpressJS Applications (NodeJS) _ Merlino Software Agency_files/701-8f3575643549621a.js.download" defer=""></script><script src="./Clean Architecture in ExpressJS Applications (NodeJS) _ Merlino Software Agency_files/19-b79b969f4b63e3b9.js.download" defer=""></script><script src="./Clean Architecture in ExpressJS Applications (NodeJS) _ Merlino Software Agency_files/880-a00ac645c9dcf0b3.js.download" defer=""></script><script src="./Clean Architecture in ExpressJS Applications (NodeJS) _ Merlino Software Agency_files/410-3acccbee986ab03d.js.download" defer=""></script><script src="./Clean Architecture in ExpressJS Applications (NodeJS) _ Merlino Software Agency_files/[slug]-e83e1f19f339c584.js.download" defer=""></script><script src="./Clean Architecture in ExpressJS Applications (NodeJS) _ Merlino Software Agency_files/_buildManifest.js.download" defer=""></script><script src="./Clean Architecture in ExpressJS Applications (NodeJS) _ Merlino Software Agency_files/_ssgManifest.js.download" defer=""></script><link rel="prefetch" as="style" href="https://c.disquscdn.com/next/embed/styles/lounge.2330dfe9833fc6fa82fa0ffee36e8c21.css"><link rel="prefetch" as="script" href="https://c.disquscdn.com/next/embed/common.bundle.c11615d75a9d8a7ebcb6b388206979fc.js"><link rel="prefetch" as="script" href="https://c.disquscdn.com/next/embed/lounge.bundle.944405f46b741461538725b083516e4d.js"><link rel="prefetch" as="script" href="https://disqus.com/next/config.js"><script src="./Clean Architecture in ExpressJS Applications (NodeJS) _ Merlino Software Agency_files/alfie_v4.63f1ab6d6b9d5807dc0c94ef3fe0b851.js.download" async="" charset="UTF-8"></script><link as="script" rel="prefetch" href="./Clean Architecture in ExpressJS Applications (NodeJS) _ Merlino Software Agency_files/index-ae1d7a0d40a8a3f2.js.download"><link as="script" rel="prefetch" href="./Clean Architecture in ExpressJS Applications (NodeJS) _ Merlino Software Agency_files/careers-f50d9edbaefca5c3.js.download"><link as="script" rel="prefetch" href="./Clean Architecture in ExpressJS Applications (NodeJS) _ Merlino Software Agency_files/837-b441fddf33c91a37.js.download"><link as="script" rel="prefetch" href="./Clean Architecture in ExpressJS Applications (NodeJS) _ Merlino Software Agency_files/blog-00d3c84f00c17751.js.download"><link as="script" rel="prefetch" href="./Clean Architecture in ExpressJS Applications (NodeJS) _ Merlino Software Agency_files/contact-us-9f39f0a4acc96baf.js.download"><link as="script" rel="prefetch" href="./Clean Architecture in ExpressJS Applications (NodeJS) _ Merlino Software Agency_files/[slug]-4617adbb4cf828c5.js.download"></head><body><div id="__next"><div class="relative bg-white" data-headlessui-state=""><div class="max-w-7xl mx-auto px-4 sm:px-6"><div class="flex justify-between items-center border-b-2 border-gray-100 py-6 md:justify-start md:space-x-10"><div class="flex justify-start lg:w-0 lg:flex-1"><a class="text-2xl font-bold tracking-wider bg-clip-text text-transparent text-merlino-500 uppercase" href="https://merlino.agency/">Merlino<span class="inline font-thin text-base lowercase text-merlino-300">.agency</span></a></div><div class="-mr-2 -my-2 md:hidden"><button class="bg-white p-2 inline-flex items-center justify-center text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-merlino-500" id="headlessui-popover-button-:r0:" type="button" aria-expanded="false" data-headlessui-state=""><span class="sr-only">Open menu</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="h-6 w-6"><path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16"></path></svg></button></div><nav class="hidden md:flex space-x-10"><div class="relative" data-headlessui-state=""><button class="text-gray-500 group bg-white inline-flex items-center text-base font-medium hover:text-gray-900 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-merlino-500" id="headlessui-popover-button-:r3:" type="button" aria-expanded="false" data-headlessui-state=""><span>Our services</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" class="text-gray-400 ml-2 h-5 w-5 group-hover:text-gray-500"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><div class="relative" data-headlessui-state=""><button class="text-gray-500 group bg-white inline-flex items-center text-base font-medium hover:text-gray-900 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-merlino-500" id="headlessui-popover-button-:r6:" type="button" aria-expanded="false" data-headlessui-state=""><span>Case Studies</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" class="text-gray-400 ml-2 h-5 w-5 group-hover:text-gray-500"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><a class="text-base font-medium text-gray-500 hover:text-gray-900" href="https://merlino.agency/careers">Careers</a><a class="text-base font-medium text-gray-500 hover:text-gray-900" href="https://merlino.agency/blog">Blog <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-pink-100 text-merlino-600">NEW</span></a></nav><div class="hidden md:flex items-center justify-end md:flex-1 lg:w-0"><a class="ml-8 whitespace-nowrap inline-flex items-center justify-center px-4 py-2 border border-transparent shadow-sm text-base font-medium text-white bg-merlino-500 hover:bg-merlino-600" href="https://merlino.agency/contact-us">Contact us</a></div></div></div></div><div class="max-w-7xl mx-auto px-4 sm:px-6"><article class="article-grid"><aside class="relative hidden lg:block" data-sticky-container="true"><div class="sticky top-20"><div><h4 class="text-lg font-bold leading-snug tracking-tight mb-4">Table of contents</h4><ul class="font-medium -my-1"><li class="py-1"><a class="flex items-center cursor-pointer hover:underline" href="https://merlino.agency/blog/clean-architecture-in-express-js-applications#introduction"><svg class="w-4 h-4 fill-current text-gray-400 mr-3 flex-shrink-0" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M7.3 8.7c-.4-.4-.4-1 0-1.4l7-7c.4-.4 1-.4 1.4 0 .4.4.4 1 0 1.4l-7 7c-.4.4-1 .4-1.4 0zM7.3 14.7c-.4-.4-.4-1 0-1.4l7-7c.4-.4 1-.4 1.4 0 .4.4.4 1 0 1.4l-7 7c-.4.4-1 .4-1.4 0zM.3 9.7c-.4-.4-.4-1 0-1.4l7-7c.4-.4 1-.4 1.4 0 .4.4.4 1 0 1.4l-7 7c-.4.4-1 .4-1.4 0z"></path></svg><span>Introduction</span></a></li><li class="py-1"><a class="flex items-center cursor-pointer hover:underline" href="https://merlino.agency/blog/clean-architecture-in-express-js-applications#what_is_software_architecture"><svg class="w-4 h-4 fill-current text-gray-400 mr-3 flex-shrink-0" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M7.3 8.7c-.4-.4-.4-1 0-1.4l7-7c.4-.4 1-.4 1.4 0 .4.4.4 1 0 1.4l-7 7c-.4.4-1 .4-1.4 0zM7.3 14.7c-.4-.4-.4-1 0-1.4l7-7c.4-.4 1-.4 1.4 0 .4.4.4 1 0 1.4l-7 7c-.4.4-1 .4-1.4 0zM.3 9.7c-.4-.4-.4-1 0-1.4l7-7c.4-.4 1-.4 1.4 0 .4.4.4 1 0 1.4l-7 7c-.4.4-1 .4-1.4 0z"></path></svg><span>What is Software Architecture</span></a></li><li class="py-1"><a class="flex items-center cursor-pointer hover:underline" href="https://merlino.agency/blog/clean-architecture-in-express-js-applications#the_clean_architecture"><svg class="w-4 h-4 fill-current text-gray-400 mr-3 flex-shrink-0" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M7.3 8.7c-.4-.4-.4-1 0-1.4l7-7c.4-.4 1-.4 1.4 0 .4.4.4 1 0 1.4l-7 7c-.4.4-1 .4-1.4 0zM7.3 14.7c-.4-.4-.4-1 0-1.4l7-7c.4-.4 1-.4 1.4 0 .4.4.4 1 0 1.4l-7 7c-.4.4-1 .4-1.4 0zM.3 9.7c-.4-.4-.4-1 0-1.4l7-7c.4-.4 1-.4 1.4 0 .4.4.4 1 0 1.4l-7 7c-.4.4-1 .4-1.4 0z"></path></svg><span>The Clean Architecture</span></a></li><li class="py-1"><a class="flex items-center cursor-pointer hover:underline" href="https://merlino.agency/blog/clean-architecture-in-express-js-applications#the_dependency_rule"><svg class="w-4 h-4 fill-current text-gray-400 mr-3 flex-shrink-0" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M7.3 8.7c-.4-.4-.4-1 0-1.4l7-7c.4-.4 1-.4 1.4 0 .4.4.4 1 0 1.4l-7 7c-.4.4-1 .4-1.4 0zM7.3 14.7c-.4-.4-.4-1 0-1.4l7-7c.4-.4 1-.4 1.4 0 .4.4.4 1 0 1.4l-7 7c-.4.4-1 .4-1.4 0zM.3 9.7c-.4-.4-.4-1 0-1.4l7-7c.4-.4 1-.4 1.4 0 .4.4.4 1 0 1.4l-7 7c-.4.4-1 .4-1.4 0z"></path></svg><span>The Dependency Rule</span></a></li><li class="py-1"><a class="flex items-center cursor-pointer hover:underline" href="https://merlino.agency/blog/clean-architecture-in-express-js-applications#four_layers_of_clean_architecture"><svg class="w-4 h-4 fill-current text-gray-400 mr-3 flex-shrink-0" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M7.3 8.7c-.4-.4-.4-1 0-1.4l7-7c.4-.4 1-.4 1.4 0 .4.4.4 1 0 1.4l-7 7c-.4.4-1 .4-1.4 0zM7.3 14.7c-.4-.4-.4-1 0-1.4l7-7c.4-.4 1-.4 1.4 0 .4.4.4 1 0 1.4l-7 7c-.4.4-1 .4-1.4 0zM.3 9.7c-.4-.4-.4-1 0-1.4l7-7c.4-.4 1-.4 1.4 0 .4.4.4 1 0 1.4l-7 7c-.4.4-1 .4-1.4 0z"></path></svg><span>Four layers of Clean Architecture</span></a></li><li class="py-1"><a class="flex items-center cursor-pointer hover:underline" href="https://merlino.agency/blog/clean-architecture-in-express-js-applications#1_entities"><svg class="w-4 h-4 fill-current text-gray-400 mr-3 flex-shrink-0" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M7.3 8.7c-.4-.4-.4-1 0-1.4l7-7c.4-.4 1-.4 1.4 0 .4.4.4 1 0 1.4l-7 7c-.4.4-1 .4-1.4 0zM7.3 14.7c-.4-.4-.4-1 0-1.4l7-7c.4-.4 1-.4 1.4 0 .4.4.4 1 0 1.4l-7 7c-.4.4-1 .4-1.4 0zM.3 9.7c-.4-.4-.4-1 0-1.4l7-7c.4-.4 1-.4 1.4 0 .4.4.4 1 0 1.4l-7 7c-.4.4-1 .4-1.4 0z"></path></svg><span>1. Entities</span></a></li><li class="py-1"><a class="flex items-center cursor-pointer hover:underline" href="https://merlino.agency/blog/clean-architecture-in-express-js-applications#2_use_cases"><svg class="w-4 h-4 fill-current text-gray-400 mr-3 flex-shrink-0" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M7.3 8.7c-.4-.4-.4-1 0-1.4l7-7c.4-.4 1-.4 1.4 0 .4.4.4 1 0 1.4l-7 7c-.4.4-1 .4-1.4 0zM7.3 14.7c-.4-.4-.4-1 0-1.4l7-7c.4-.4 1-.4 1.4 0 .4.4.4 1 0 1.4l-7 7c-.4.4-1 .4-1.4 0zM.3 9.7c-.4-.4-.4-1 0-1.4l7-7c.4-.4 1-.4 1.4 0 .4.4.4 1 0 1.4l-7 7c-.4.4-1 .4-1.4 0z"></path></svg><span>2. Use Cases</span></a></li><li class="py-1"><a class="flex items-center cursor-pointer hover:underline" href="https://merlino.agency/blog/clean-architecture-in-express-js-applications#3_interface_adapters"><svg class="w-4 h-4 fill-current text-gray-400 mr-3 flex-shrink-0" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M7.3 8.7c-.4-.4-.4-1 0-1.4l7-7c.4-.4 1-.4 1.4 0 .4.4.4 1 0 1.4l-7 7c-.4.4-1 .4-1.4 0zM7.3 14.7c-.4-.4-.4-1 0-1.4l7-7c.4-.4 1-.4 1.4 0 .4.4.4 1 0 1.4l-7 7c-.4.4-1 .4-1.4 0zM.3 9.7c-.4-.4-.4-1 0-1.4l7-7c.4-.4 1-.4 1.4 0 .4.4.4 1 0 1.4l-7 7c-.4.4-1 .4-1.4 0z"></path></svg><span>3. Interface Adapters</span></a></li><li class="py-1"><a class="flex items-center cursor-pointer hover:underline" href="https://merlino.agency/blog/clean-architecture-in-express-js-applications#4_routes"><svg class="w-4 h-4 fill-current text-gray-400 mr-3 flex-shrink-0" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M7.3 8.7c-.4-.4-.4-1 0-1.4l7-7c.4-.4 1-.4 1.4 0 .4.4.4 1 0 1.4l-7 7c-.4.4-1 .4-1.4 0zM7.3 14.7c-.4-.4-.4-1 0-1.4l7-7c.4-.4 1-.4 1.4 0 .4.4.4 1 0 1.4l-7 7c-.4.4-1 .4-1.4 0zM.3 9.7c-.4-.4-.4-1 0-1.4l7-7c.4-.4 1-.4 1.4 0 .4.4.4 1 0 1.4l-7 7c-.4.4-1 .4-1.4 0z"></path></svg><span>4. Routes</span></a></li><li class="py-1"><a class="flex items-center cursor-pointer hover:underline" href="https://merlino.agency/blog/clean-architecture-in-express-js-applications#5_frameworks_and_drivers"><svg class="w-4 h-4 fill-current text-gray-400 mr-3 flex-shrink-0" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M7.3 8.7c-.4-.4-.4-1 0-1.4l7-7c.4-.4 1-.4 1.4 0 .4.4.4 1 0 1.4l-7 7c-.4.4-1 .4-1.4 0zM7.3 14.7c-.4-.4-.4-1 0-1.4l7-7c.4-.4 1-.4 1.4 0 .4.4.4 1 0 1.4l-7 7c-.4.4-1 .4-1.4 0zM.3 9.7c-.4-.4-.4-1 0-1.4l7-7c.4-.4 1-.4 1.4 0 .4.4.4 1 0 1.4l-7 7c-.4.4-1 .4-1.4 0z"></path></svg><span>5. Frameworks and Drivers</span></a></li><li class="py-1"><a class="flex items-center cursor-pointer hover:underline" href="https://merlino.agency/blog/clean-architecture-in-express-js-applications#conclusion"><svg class="w-4 h-4 fill-current text-gray-400 mr-3 flex-shrink-0" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M7.3 8.7c-.4-.4-.4-1 0-1.4l7-7c.4-.4 1-.4 1.4 0 .4.4.4 1 0 1.4l-7 7c-.4.4-1 .4-1.4 0zM7.3 14.7c-.4-.4-.4-1 0-1.4l7-7c.4-.4 1-.4 1.4 0 .4.4.4 1 0 1.4l-7 7c-.4.4-1 .4-1.4 0zM.3 9.7c-.4-.4-.4-1 0-1.4l7-7c.4-.4 1-.4 1.4 0 .4.4.4 1 0 1.4l-7 7c-.4.4-1 .4-1.4 0z"></path></svg><span>Conclusion</span></a></li></ul></div><div class="mt-4"><a target="_blank" rel="noreferrer" href="https://getisla.com/?utm_source=blog&amp;utm_medium=banner&amp;utm_campaign=calendly_for_task_management"><img alt="Isla: Universal Interface for Task Management" srcset="/_next/image?url=%2Fbanners%2Fisla-banner.jpg&amp;w=640&amp;q=75 1x, /_next/image?url=%2Fbanners%2Fisla-banner.jpg&amp;w=1080&amp;q=75 2x" src="./Clean Architecture in ExpressJS Applications (NodeJS) _ Merlino Software Agency_files/isla-banner.jpg" width="540" height="1080" decoding="async" data-nimg="1" loading="lazy" style="color: transparent;"></a></div></div></aside><div><div class="w-full mb-8"><img class="w-full rounded-md" src="./Clean Architecture in ExpressJS Applications (NodeJS) _ Merlino Software Agency_files/Clean_Architecture_in_ExpressJS_Applications.png" alt="Clean Architecture in ExpressJS Applications.png" width="1600" height="960"></div><header class="max-w-3xl mb-12"><h1 class="h1 text-left mb-4">Clean Architecture in ExpressJS Applications (NodeJS)</h1><div class="text-start"><a class="inline-flex items-center mr-2 my-1 px-3 py-1 rounded-md text-sm font-normal bg-pink-100 text-merlino-600 cursor-pointer hover:bg-pink-50" href="https://merlino.agency/blog/topic/clean-architecture">#clean-architecture</a><a class="inline-flex items-center mr-2 my-1 px-3 py-1 rounded-md text-sm font-normal bg-pink-100 text-merlino-600 cursor-pointer hover:bg-pink-50" href="https://merlino.agency/blog/topic/express">#express</a><a class="inline-flex items-center mr-2 my-1 px-3 py-1 rounded-md text-sm font-normal bg-pink-100 text-merlino-600 cursor-pointer hover:bg-pink-50" href="https://merlino.agency/blog/topic/javascript">#javascript</a><a class="inline-flex items-center mr-2 my-1 px-3 py-1 rounded-md text-sm font-normal bg-pink-100 text-merlino-600 cursor-pointer hover:bg-pink-50" href="https://merlino.agency/blog/topic/nodejs">#nodejs</a><a class="inline-flex items-center mr-2 my-1 px-3 py-1 rounded-md text-sm font-normal bg-pink-100 text-merlino-600 cursor-pointer hover:bg-pink-50" href="https://merlino.agency/blog/topic/software-architecture">#software-architecture</a><a class="inline-flex items-center mr-2 my-1 px-3 py-1 rounded-md text-sm font-normal bg-pink-100 text-merlino-600 cursor-pointer hover:bg-pink-50" href="https://merlino.agency/blog/topic/software-engineering">#software-engineering</a></div></header><div class="flex items-center mb-4"><div class="flex flex-shrink-0 mr-3"><span class="relative"><span class="absolute inset-0 -m-px" aria-hidden="true"><span class="absolute inset-0 -m-px bg-white rounded-full"></span></span><img class="relative rounded-lg" src="./Clean Architecture in ExpressJS Applications (NodeJS) _ Merlino Software Agency_files/J4P9ISo6_400x400.jpg" alt="Hassib Moddasser" width="44" height="44"></span></div><div><p><span class="text-gray-600">By </span><span class="font-medium">Hassib Moddasser</span></p><p class="text-gray-600"><span>Last update on Dec 06, 2022</span><span class="text-lg"> · </span><span>9 minutes</span></p></div></div><div class="flex flex-row space-x-3 mb-6"><button aria-label="email" class="react-share__ShareButton" style="background-color: transparent; border: none; padding: 0px; font: inherit; color: inherit; cursor: pointer;"><svg viewBox="0 0 64 64" width="24" height="24"><circle cx="32" cy="32" r="31" fill="#7f7f7f"></circle><path d="M17,22v20h30V22H17z M41.1,25L32,32.1L22.9,25H41.1z M20,39V26.6l12,9.3l12-9.3V39H20z" fill="white"></path></svg></button><button aria-label="facebook" class="react-share__ShareButton" style="background-color: transparent; border: none; padding: 0px; font: inherit; color: inherit; cursor: pointer;"><svg viewBox="0 0 64 64" width="24" height="24"><circle cx="32" cy="32" r="31" fill="#3b5998"></circle><path d="M34.1,47V33.3h4.6l0.7-5.3h-5.3v-3.4c0-1.5,0.4-2.6,2.6-2.6l2.8,0v-4.8c-0.5-0.1-2.2-0.2-4.1-0.2 c-4.1,0-6.9,2.5-6.9,7V28H24v5.3h4.6V47H34.1z" fill="white"></path></svg></button><button aria-label="linkedin" class="react-share__ShareButton" style="background-color: transparent; border: none; padding: 0px; font: inherit; color: inherit; cursor: pointer;"><svg viewBox="0 0 64 64" width="24" height="24"><circle cx="32" cy="32" r="31" fill="#007fb1"></circle><path d="M20.4,44h5.4V26.6h-5.4V44z M23.1,18c-1.7,0-3.1,1.4-3.1,3.1c0,1.7,1.4,3.1,3.1,3.1 c1.7,0,3.1-1.4,3.1-3.1C26.2,19.4,24.8,18,23.1,18z M39.5,26.2c-2.6,0-4.4,1.4-5.1,2.8h-0.1v-2.4h-5.2V44h5.4v-8.6 c0-2.3,0.4-4.5,3.2-4.5c2.8,0,2.8,2.6,2.8,4.6V44H46v-9.5C46,29.8,45,26.2,39.5,26.2z" fill="white"></path></svg></button><button aria-label="telegram" class="react-share__ShareButton" style="background-color: transparent; border: none; padding: 0px; font: inherit; color: inherit; cursor: pointer;"><svg viewBox="0 0 64 64" width="24" height="24"><circle cx="32" cy="32" r="31" fill="#37aee2"></circle><path d="m45.90873,15.44335c-0.6901,-0.0281 -1.37668,0.14048 -1.96142,0.41265c-0.84989,0.32661 -8.63939,3.33986 -16.5237,6.39174c-3.9685,1.53296 -7.93349,3.06593 -10.98537,4.24067c-3.05012,1.1765 -5.34694,2.05098 -5.4681,2.09312c-0.80775,0.28096 -1.89996,0.63566 -2.82712,1.72788c-0.23354,0.27218 -0.46884,0.62161 -0.58825,1.10275c-0.11941,0.48114 -0.06673,1.09222 0.16682,1.5716c0.46533,0.96052 1.25376,1.35737 2.18443,1.71383c3.09051,0.99037 6.28638,1.93508 8.93263,2.8236c0.97632,3.44171 1.91401,6.89571 2.84116,10.34268c0.30554,0.69185 0.97105,0.94823 1.65764,0.95525l-0.00351,0.03512c0,0 0.53908,0.05268 1.06412,-0.07375c0.52679,-0.12292 1.18879,-0.42846 1.79109,-0.99212c0.662,-0.62161 2.45836,-2.38812 3.47683,-3.38552l7.6736,5.66477l0.06146,0.03512c0,0 0.84989,0.59703 2.09312,0.68132c0.62161,0.04214 1.4399,-0.07726 2.14229,-0.59176c0.70766,-0.51626 1.1765,-1.34683 1.396,-2.29506c0.65673,-2.86224 5.00979,-23.57745 5.75257,-27.00686l-0.02107,0.08077c0.51977,-1.93157 0.32837,-3.70159 -0.87096,-4.74991c-0.60054,-0.52152 -1.2924,-0.7498 -1.98425,-0.77965l0,0.00176zm-0.2072,3.29069c0.04741,0.0439 0.0439,0.0439 0.00351,0.04741c-0.01229,-0.00351 0.14048,0.2072 -0.15804,1.32576l-0.01229,0.04214l-0.00878,0.03863c-0.75858,3.50668 -5.15554,24.40802 -5.74203,26.96472c-0.08077,0.34417 -0.11414,0.31959 -0.09482,0.29852c-0.1756,-0.02634 -0.50045,-0.16506 -0.52679,-0.1756l-13.13468,-9.70175c4.4988,-4.33199 9.09945,-8.25307 13.744,-12.43229c0.8218,-0.41265 0.68483,-1.68573 -0.29852,-1.70681c-1.04305,0.24584 -1.92279,0.99564 -2.8798,1.47502c-5.49971,3.2626 -11.11882,6.13186 -16.55882,9.49279c-2.792,-0.97105 -5.57873,-1.77704 -8.15298,-2.57601c2.2336,-0.89555 4.00889,-1.55579 5.75608,-2.23009c3.05188,-1.1765 7.01687,-2.7042 10.98537,-4.24067c7.94051,-3.06944 15.92667,-6.16346 16.62028,-6.43037l0.05619,-0.02283l0.05268,-0.02283c0.19316,-0.0878 0.30378,-0.09658 0.35471,-0.10009c0,0 -0.01756,-0.05795 -0.00351,-0.04566l-0.00176,0zm-20.91715,22.0638l2.16687,1.60145c-0.93418,0.91311 -1.81743,1.77353 -2.45485,2.38812l0.28798,-3.98957" fill="white"></path></svg></button><button aria-label="twitter" class="react-share__ShareButton" style="background-color: transparent; border: none; padding: 0px; font: inherit; color: inherit; cursor: pointer;"><svg viewBox="0 0 64 64" width="24" height="24"><circle cx="32" cy="32" r="31" fill="#00aced"></circle><path d="M48,22.1c-1.2,0.5-2.4,0.9-3.8,1c1.4-0.8,2.4-2.1,2.9-3.6c-1.3,0.8-2.7,1.3-4.2,1.6 C41.7,19.8,40,19,38.2,19c-3.6,0-6.6,2.9-6.6,6.6c0,0.5,0.1,1,0.2,1.5c-5.5-0.3-10.3-2.9-13.5-6.9c-0.6,1-0.9,2.1-0.9,3.3 c0,2.3,1.2,4.3,2.9,5.5c-1.1,0-2.1-0.3-3-0.8c0,0,0,0.1,0,0.1c0,3.2,2.3,5.8,5.3,6.4c-0.6,0.1-1.1,0.2-1.7,0.2c-0.4,0-0.8,0-1.2-0.1 c0.8,2.6,3.3,4.5,6.1,4.6c-2.2,1.8-5.1,2.8-8.2,2.8c-0.5,0-1.1,0-1.6-0.1c2.9,1.9,6.4,2.9,10.1,2.9c12.1,0,18.7-10,18.7-18.7 c0-0.3,0-0.6,0-0.8C46,24.5,47.1,23.4,48,22.1z" fill="white"></path></svg></button><button aria-label="whatsapp" class="react-share__ShareButton" style="background-color: transparent; border: none; padding: 0px; font: inherit; color: inherit; cursor: pointer;"><svg viewBox="0 0 64 64" width="24" height="24"><circle cx="32" cy="32" r="31" fill="#25D366"></circle><path d="m42.32286,33.93287c-0.5178,-0.2589 -3.04726,-1.49644 -3.52105,-1.66732c-0.4712,-0.17346 -0.81554,-0.2589 -1.15987,0.2589c-0.34175,0.51004 -1.33075,1.66474 -1.63108,2.00648c-0.30032,0.33658 -0.60064,0.36247 -1.11327,0.12945c-0.5178,-0.2589 -2.17994,-0.80259 -4.14759,-2.56312c-1.53269,-1.37217 -2.56312,-3.05503 -2.86603,-3.57283c-0.30033,-0.5178 -0.03366,-0.80259 0.22524,-1.06149c0.23301,-0.23301 0.5178,-0.59547 0.7767,-0.90616c0.25372,-0.31068 0.33657,-0.5178 0.51262,-0.85437c0.17088,-0.36246 0.08544,-0.64725 -0.04402,-0.90615c-0.12945,-0.2589 -1.15987,-2.79613 -1.58964,-3.80584c-0.41424,-1.00971 -0.84142,-0.88027 -1.15987,-0.88027c-0.29773,-0.02588 -0.64208,-0.02588 -0.98382,-0.02588c-0.34693,0 -0.90616,0.12945 -1.37736,0.62136c-0.4712,0.5178 -1.80194,1.76053 -1.80194,4.27186c0,2.51134 1.84596,4.945 2.10227,5.30747c0.2589,0.33657 3.63497,5.51458 8.80262,7.74113c1.23237,0.5178 2.1903,0.82848 2.94111,1.08738c1.23237,0.38836 2.35599,0.33657 3.24402,0.20712c0.99159,-0.15534 3.04985,-1.24272 3.47963,-2.45956c0.44013,-1.21683 0.44013,-2.22654 0.31068,-2.45955c-0.12945,-0.23301 -0.46601,-0.36247 -0.98382,-0.59548m-9.40068,12.84407l-0.02589,0c-3.05503,0 -6.08417,-0.82849 -8.72495,-2.38189l-0.62136,-0.37023l-6.47252,1.68286l1.73463,-6.29129l-0.41424,-0.64725c-1.70875,-2.71846 -2.6149,-5.85116 -2.6149,-9.07706c0,-9.39809 7.68934,-17.06155 17.15993,-17.06155c4.58253,0 8.88029,1.78642 12.11655,5.02268c3.23625,3.21036 5.02267,7.50812 5.02267,12.06476c-0.0078,9.3981 -7.69712,17.06155 -17.14699,17.06155m14.58906,-31.58846c-3.93529,-3.80584 -9.1133,-5.95471 -14.62789,-5.95471c-11.36055,0 -20.60848,9.2065 -20.61625,20.52564c0,3.61684 0.94757,7.14565 2.75211,10.26282l-2.92557,10.63564l10.93337,-2.85309c3.0136,1.63108 6.4052,2.4958 9.85634,2.49839l0.01037,0c11.36574,0 20.61884,-9.2091 20.62403,-20.53082c0,-5.48093 -2.14111,-10.64081 -6.03239,-14.51915" fill="white"></path></svg></button></div><hr class="w-16 h-px pt-px bg-gray-200 border-0 mb-6"><div class="text-lg text-gray-600"><p class="mb-4"><strong class="font-semibold text-lg">I can't emphasize enough</strong> how learning and implementing the <i>Clean Architecture</i> in all our projects <strong class="font-semibold text-lg">has saved—and is saving—us so much time</strong> in the <i>development of new features</i>, the <i>testability of the system</i>, and the <i>general maintenance of their components</i>.</p><p class="mb-4">Implementing it will require a little effort in understanding how it works and will also generate a bit more files than just following, for example, the ExpressJS Getting Started guide.</p><p class="mb-4">However, we will never go back. It served us so robustly that we'll just keep focusing on shipping.</p><p class="mb-4">Now, let's start. </p><h2 id="introduction" class="h2 text-gray-900 mb-4 mt-10 scroll-mt-24">Introduction</h2><p class="mb-4">The secret to building a large project that is easy to maintain and performs better is to separate files and classes into components that can change independently without affecting other components: this is what Clean Architecture is all about.</p><p class="mb-4">Clean Architecture is an architectural style created by <i>Robert C. Martin</i>. It is a set of standards that aims to develop an application that makes it easier to quality code that will perform better, is easy to maintain, and has fewer dependencies as the project grows.</p><p class="mb-4">Firstly, I will introduce what Clean Architecture is. We will then head to the development side of things to see how the engineering team at <a href="https://merlino.agency/" target="_blank" rel="noopener noreferrer" class="inline items-center text-merlino-600 font-medium hover:decoration-merlino-600 underline decoration-merlino-500">Merlino Software Agency</a> developed<strong class="font-semibold text-lg"> </strong><a href="https://1-food.com/" target="_blank" rel="noopener noreferrer" class="inline items-center text-merlino-600 font-medium hover:decoration-merlino-600 underline decoration-merlino-500"><strong class="font-semibold text-lg">OneFood</strong></a> and <a href="https://getisla.com/" target="_blank" rel="noopener noreferrer" class="inline items-center text-merlino-600 font-medium hover:decoration-merlino-600 underline decoration-merlino-500"><strong class="font-semibold text-lg">Isla</strong></a> using NodeJS/<strong class="font-semibold text-lg">ExpressJS</strong> with a Clean Architecture. In the end, we will conclude how Clean Architecture makes a difference.</p><p class="mb-4">According to <a href="https://insights.stackoverflow.com/survey/2021" target="_blank" rel="noopener noreferrer" class="inline items-center text-merlino-600 font-medium hover:decoration-merlino-600 underline decoration-merlino-500">Stack Overflow Insights of 2021</a>, JavaScript completes its ninth year in a row as the most commonly used programming language. NodeJS is placed as the sixth most widely used tool, and Express JS, a minimal Node JS framework, got the third position as the most common web framework. Therefore, having your application in Express JS decorated with Clean Architecture is a blessing that leads to better performance and easy maintainability of the project.</p><p class="mb-4">Let us have a quick introduction to Software Architecture before diving into it!</p><h2 id="what_is_software_architecture" class="h2 text-gray-900 mb-4 mt-10 scroll-mt-24">What is Software Architecture</h2><p class="mb-4">Before providing a definition, consider that the actions people may do using systems on a daily basis — scheduling a Tweet to post, sending an automated transactional email, etc. — heavily depend on the Software Architecture of the system in use.</p><p class="mb-4">Many things we know and use would be impossible without software architecture, but why is that?</p><p class="mb-4">A system's architecture acts as a blueprint. It establishes a communication and coordination mechanism among components, gives an abstraction to control system complexity, and represents the design decisions related to overall system structure and behavior.</p><p class="mb-4">In simple words, <strong class="font-semibold text-lg">Software Architecture exposes a system's structure while hiding implementation details</strong>. Moreover,<strong class="font-semibold text-lg"> it also focuses on how the elements and components within a system interact with one another</strong>.</p><p class="mb-4">The subject of Software Architecture appears to have sparked much attention in recent years. Furthermore, among the many different types and styles, Clean Architecture attracted more attention than the others.</p><p class="mb-4">Let us head to the central part of the article and find out what Clean Architecture is.</p><h2 id="the_clean_architecture" class="h2 text-gray-900 mb-4 mt-10 scroll-mt-24">The Clean Architecture</h2><p class="mb-4">Microservices and serverless architecture have emerged as revolutionary architectural patterns in the software development world during the last several years. Each has its characteristics, behaviors, technological structure, and required expertise. However, they are all part of a broader desire for a better separation of architecture concerns and improved testability.</p><p class="mb-4"><strong class="font-semibold text-lg">Clean Architecture is a set of standards that aims to develop layered architectures that make it easier to write quality code that will perform better, is easy to maintain, and has fewer dependencies as the project grows.</strong> This architecture can be applied no matter what language you code in.</p><p class="mb-4">The illustration below shows the four concentric circles that compose a Clean Architecture, how they interact with each other, and their dependencies.</p><div class="mb-4"><img alt="Robert C. Martin Clean Architecture Diagram" srcset="/_next/image?url=https%3A%2F%2Fimages.ctfassets.net%2Fvsall43tabcn%2FgyZteBML1XipqwnZTPzRJ%2F0ad14b0e2271d7797e92791b66689ff3%2FClean_Architecture.jpeg&amp;w=828&amp;q=75 1x, /_next/image?url=https%3A%2F%2Fimages.ctfassets.net%2Fvsall43tabcn%2FgyZteBML1XipqwnZTPzRJ%2F0ad14b0e2271d7797e92791b66689ff3%2FClean_Architecture.jpeg&amp;w=1920&amp;q=75 2x" src="./Clean Architecture in ExpressJS Applications (NodeJS) _ Merlino Software Agency_files/Clean_Architecture.jpg" width="772" height="567" decoding="async" data-nimg="1" class="border border-gray-200 shadow-sm" loading="lazy" style="color: transparent;"><small class="text-xs italic text-gray-400">Robert C. Martin Clean Architecture Diagram</small></div><h2 id="the_dependency_rule" class="h2 text-gray-900 mb-4 mt-10 scroll-mt-24">The Dependency Rule</h2><div class="mb-4"><img alt="Clean Architecture Dependencies" srcset="/_next/image?url=https%3A%2F%2Fimages.ctfassets.net%2Fvsall43tabcn%2F4CgiAa0sslHOzxoizCwTQd%2F0170d90c220101105b51630a2a7d13ba%2FScreenshot_2021-12-12_at_11.37.19.png&amp;w=1200&amp;q=75 1x, /_next/image?url=https%3A%2F%2Fimages.ctfassets.net%2Fvsall43tabcn%2F4CgiAa0sslHOzxoizCwTQd%2F0170d90c220101105b51630a2a7d13ba%2FScreenshot_2021-12-12_at_11.37.19.png&amp;w=3840&amp;q=75 2x" src="./Clean Architecture in ExpressJS Applications (NodeJS) _ Merlino Software Agency_files/Screenshot_2021-12-12_at_11.png" width="1200" height="258" decoding="async" data-nimg="1" class="border border-gray-200 shadow-sm" loading="lazy" style="color: transparent;"><small class="text-xs italic text-gray-400">Clean Architecture Dependencies</small></div><p class="mb-4">In the illustration above, please pay attention to the arrows, the fact that they are pointing from the outermost circle down into the innermost circle, and that they only go in one direction. The arrows represent the dependence flow, indicating that an outer ring can depend on an inner ring but that an inner ring cannot rely on an outer ring; this is what <i>The Dependency Rule</i> is all about.</p><p class="mb-4">For example, <i>Entities</i> know nothing about all the other circles, while the <i>Frameworks &amp; Drivers</i><strong class="font-semibold text-lg">,</strong> the outer layer, know everything about the inner rings.</p><p class="mb-4">In simple words, <i>variables</i>, <i>functions</i>, <i>classes</i>, or any other named software entity declared in an outer circle must not be mentioned by the code in an inner circle.</p><h2 id="four_layers_of_clean_architecture" class="h2 text-gray-900 mb-4 mt-10 scroll-mt-24">Four layers of Clean Architecture</h2><p class="mb-4">There are four concentric circles in Clean Architecture that each represents different areas of Software, which are as below:</p><ol class="list-disc list-inside mb-8"><li class="mb-1">Entities</li><li class="mb-1">Use Cases</li><li class="mb-1">Interface Adapters</li><li class="mb-1">Frameworks and Drivers</li></ol><p class="mb-4">The development team of Merlino also implemented another layer called <i>Routes</i>, and that's totally okay. If you find that you may need more than four, just go on. However, the <i>Dependency Rule</i> must always apply.</p><p class="mb-4">So, the four layers become five layers in our case study, which are as below:</p><ol class="list-disc list-inside mb-8"><li class="mb-1">Entities (Mongoose models and their abstraction)</li><li class="mb-1">Use Cases</li><li class="mb-1">Interface Adapters (Controllers)</li><li class="mb-1">Routes</li><li class="mb-1">Frameworks and Drivers</li></ol><p class="mb-4">Let us find out what each circle means along with our case study, but before diving in, here is the project's hierarchy;</p><p class="mb-4"><pre class="prism-code language-plaintext relative w-full mb-7 mt-3 text-left"><div class="absolute top-0 right-0 bg-gray-50 p-1 text-xs border border-gray-200 font-jetbrains text-gray-600 flex flex-row"><span>plaintext</span><span class="mx-2 text-gray-300">|</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="h-4 w-4"><path stroke-linecap="round" stroke-linejoin="round" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"></path></svg></div><div class="p-2 shadow-sm border border-gray-200 text-sm font-jetbrains w-full overflow-x-auto"><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">1</span><span class="table-cell"><span class="token plain">.</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">2</span><span class="table-cell"><span class="token plain">│   README.md</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">3</span><span class="table-cell"><span class="token plain">│   package.json  </span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">4</span><span class="table-cell"><span class="token plain">│   ...   </span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">5</span><span class="table-cell"><span class="token plain">│</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">6</span><span class="table-cell"><span class="token plain">└─── app</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">7</span><span class="table-cell"><span class="token plain">│   │   app.js // 5. Framework and Drivers</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">8</span><span class="table-cell"><span class="token plain">│   │   server.js // start master and forks other workers</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">9</span><span class="table-cell"><span class="token plain">│   │   config.js // get config from env or config file</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">10</span><span class="table-cell"><span class="token plain">│   │   database.js</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">11</span><span class="table-cell"><span class="token plain">│   │   logger.js</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">12</span><span class="table-cell"><span class="token plain">│   │</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">13</span><span class="table-cell"><span class="token plain">│   └─── models // 1.a) entities (i.e., Mongoose models)</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">14</span><span class="table-cell"><span class="token plain">│   │   │   index.js</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">15</span><span class="table-cell"><span class="token plain">│   │   │   orders.model.js</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">16</span><span class="table-cell"><span class="token plain">│   │   │   ...</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">17</span><span class="table-cell"><span class="token plain">│   │</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">18</span><span class="table-cell"><span class="token plain">│   └─── data-access // 1.b) entities (i.e., abstraction of Mongoose models)</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">19</span><span class="table-cell"><span class="token plain">│   │   │   index.js</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">20</span><span class="table-cell"><span class="token plain">│   │   │   orders.db.js</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">21</span><span class="table-cell"><span class="token plain">│   │   │   ...</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">22</span><span class="table-cell"><span class="token plain">│   │</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">23</span><span class="table-cell"><span class="token plain">│   └─── use-cases // 2) Use cases</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">24</span><span class="table-cell"><span class="token plain">│   │   └─── orders</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">25</span><span class="table-cell"><span class="token plain">│   │   │   │   index.js</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">26</span><span class="table-cell"><span class="token plain">│   │   │   │   post-order.js</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">27</span><span class="table-cell"><span class="token plain">│   │   │   │   ...</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">28</span><span class="table-cell"><span class="token plain">│   │   └─── ...</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">29</span><span class="table-cell"><span class="token plain">│   │</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">30</span><span class="table-cell"><span class="token plain">│   └─── controllers // 3) Interface Adapters</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">31</span><span class="table-cell"><span class="token plain">│   │   │   order.controller.js</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">32</span><span class="table-cell"><span class="token plain">│   │   │   ...</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">33</span><span class="table-cell"><span class="token plain">│   │</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">34</span><span class="table-cell"><span class="token plain">│   └─── routes // 4) Routes</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">35</span><span class="table-cell"><span class="token plain">│   │   │   order.routes.js</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">36</span><span class="table-cell"><span class="token plain">│   │   │   ...</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">37</span><span class="table-cell"><span class="token plain">│   </span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">38</span><span class="table-cell"><span class="token plain">└─── ...</span></span></div></div></pre></p><h2 id="1_entities" class="h2 text-gray-900 mb-4 mt-10 scroll-mt-24">1. Entities</h2><p class="mb-4">At the center of the onion are the Entities of the software, which constitute the business logic of software. An entity can be an object with methods, or it can be a set of data structures and functions, they don't know anything about the outer layers and don't have any dependency.</p><p class="mb-4">In simple words, <strong class="font-semibold text-lg">Entities are the primary concepts of your business</strong>.</p><p class="mb-4">When something external happens, <i>Entities</i> are the least likely to change. A change to page navigation or security, for example, would not be expected to affect these objects. The entity circle should not be affected by any operational changes to any application.</p><p class="mb-4">If you're building a Social Media application, you might have entities like <i>Posts</i>, <i>Comment</i>, or <i>User</i>, or in the case of <a href="https://1-food.com/?utm_source=merlino_agency&amp;utm_medium=blog&amp;utm_campaign=clean_architecture" target="_blank" rel="noopener noreferrer" class="inline items-center text-merlino-600 font-medium hover:decoration-merlino-600 underline decoration-merlino-500">OneFood</a> — a premium food delivery business and a client of ours — a few of their entities would be <i>Customer</i>, <i>Order</i>, <i>Payment</i>, <i>Product</i>, <i>Vendor</i>, etc.</p><p class="mb-4"><u>Important to consider</u> is that since we use <a href="https://mongoosejs.com/docs/" target="_blank" rel="noopener noreferrer" class="inline items-center text-merlino-600 font-medium hover:decoration-merlino-600 underline decoration-merlino-500">Mongoose</a>, we'll also have model definitions, which are specific to this implementation and we'll soon see how to abstract them. All models are then exported like follows:</p><p class="mb-4">All <i>Entities</i> can then be exported like this:</p><p class="mb-4"><pre class="prism-code language-javascript relative w-full mb-7 mt-3 text-left"><div class="absolute top-0 right-0 bg-gray-50 p-1 text-xs border border-gray-200 font-jetbrains text-gray-600 flex flex-row"><span>javascript</span><span class="mx-2 text-gray-300">|</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="h-4 w-4"><path stroke-linecap="round" stroke-linejoin="round" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"></path></svg></div><div class="p-2 shadow-sm border border-gray-200 text-sm font-jetbrains w-full overflow-x-auto"><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">1</span><span class="table-cell"><span class="token comment">// /models/index.js</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">2</span><span class="table-cell"><span class="token plain">
</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">3</span><span class="table-cell"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">Orders</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">'./orders.model'</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">4</span><span class="table-cell"><span class="token plain"></span><span class="token comment">// ...</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">5</span><span class="table-cell"><span class="token plain">
</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">6</span><span class="table-cell"><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">7</span><span class="table-cell"><span class="token plain">  </span><span class="token maybe-class-name">Orders</span><span class="token punctuation">,</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">8</span><span class="table-cell"><span class="token plain">  </span><span class="token comment">// ...</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">9</span><span class="table-cell"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span></span></div></div></pre></p><p class="mb-4">Then, in `data-access`, let's create an abstraction layer that allows us to decouple the database methods that we call in our application (i.e., `findOne`, insert`, etc.) from the type of database, in this case, MongoDB. We might want to change to a SQL database in the future and that'll be totally fine. One could argue that this is what <a href="https://www.prisma.io/" target="_blank" rel="noopener noreferrer" class="inline items-center text-merlino-600 font-medium hover:decoration-merlino-600 underline decoration-merlino-500">Prisma</a> does as a service.</p><p class="mb-4"><pre class="prism-code language-javascript relative w-full mb-7 mt-3 text-left"><div class="absolute top-0 right-0 bg-gray-50 p-1 text-xs border border-gray-200 font-jetbrains text-gray-600 flex flex-row"><span>javascript</span><span class="mx-2 text-gray-300">|</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="h-4 w-4"><path stroke-linecap="round" stroke-linejoin="round" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"></path></svg></div><div class="p-2 shadow-sm border border-gray-200 text-sm font-jetbrains w-full overflow-x-auto"><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">1</span><span class="table-cell"><span class="token comment">// /data-access/orders.db.js</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">2</span><span class="table-cell"><span class="token plain">
</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">3</span><span class="table-cell"><span class="token plain"></span><span class="token comment">// outside libraries are ok to import</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">4</span><span class="table-cell"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports punctuation">{</span><span class="token imports">v4 </span><span class="token imports keyword module">as</span><span class="token imports"> uuid</span><span class="token imports punctuation">}</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">"uuid"</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">5</span><span class="table-cell"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports">_</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">"lodash"</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">6</span><span class="table-cell"><span class="token plain">
</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">7</span><span class="table-cell"><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword module">default</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">makeOrdersDb</span><span class="token punctuation">(</span><span class="token parameter punctuation">{</span><span class="token parameter maybe-class-name">Orders</span><span class="token parameter punctuation">}</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">8</span><span class="table-cell"><span class="token plain">  </span><span class="token keyword">async</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token parameter">_filter</span><span class="token parameter punctuation">,</span><span class="token parameter"> _options </span><span class="token parameter operator">=</span><span class="token parameter"> </span><span class="token parameter punctuation">{</span><span class="token parameter punctuation">}</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">9</span><span class="table-cell"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain">populate</span><span class="token punctuation">,</span><span class="token plain"> sort</span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> _options</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">10</span><span class="table-cell"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> query </span><span class="token operator">=</span><span class="token plain"> </span><span class="token maybe-class-name">Orders</span><span class="token punctuation">.</span><span class="token method function property-access">findOne</span><span class="token punctuation">(</span><span class="token plain">_filter</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">11</span><span class="table-cell"><span class="token plain">    </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">sort</span><span class="token punctuation">)</span><span class="token plain"> query</span><span class="token punctuation">.</span><span class="token method function property-access">sort</span><span class="token punctuation">(</span><span class="token plain">sort</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">12</span><span class="table-cell"><span class="token plain">    _</span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token plain">populate </span><span class="token operator">||</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">p</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> query</span><span class="token punctuation">.</span><span class="token method function property-access">populate</span><span class="token punctuation">(</span><span class="token plain">p</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">13</span><span class="table-cell"><span class="token plain">    </span><span class="token keyword control-flow">return</span><span class="token plain"> query</span><span class="token punctuation">.</span><span class="token method function property-access">lean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">14</span><span class="table-cell"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">15</span><span class="table-cell"><span class="token plain">  </span><span class="token keyword">async</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token parameter punctuation">{</span><span class="token parameter literal-property property">id</span><span class="token parameter operator">:</span><span class="token parameter"> _id </span><span class="token parameter operator">=</span><span class="token parameter"> </span><span class="token parameter function">uuid</span><span class="token parameter punctuation">(</span><span class="token parameter punctuation">)</span><span class="token parameter punctuation">,</span><span class="token parameter"> </span><span class="token parameter spread operator">...</span><span class="token parameter">orderInfo</span><span class="token parameter punctuation">}</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">16</span><span class="table-cell"><span class="token plain">    </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token maybe-class-name">Orders</span><span class="token punctuation">.</span><span class="token method function property-access">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain">_id</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token spread operator">...</span><span class="token plain">orderInfo</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">17</span><span class="table-cell"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">18</span><span class="table-cell"><span class="token plain">  </span><span class="token keyword">async</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">_filter</span><span class="token parameter punctuation">,</span><span class="token parameter"> _orderInfo</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">19</span><span class="table-cell"><span class="token plain">    </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token maybe-class-name">Orders</span><span class="token punctuation">.</span><span class="token method function property-access">findOneAndUpdate</span><span class="token punctuation">(</span><span class="token plain">_filter</span><span class="token punctuation">,</span><span class="token plain"> _orderInfo</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token keyword">new</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">20</span><span class="table-cell"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">21</span><span class="table-cell"><span class="token plain">  </span><span class="token keyword">async</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token parameter">_id</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">22</span><span class="table-cell"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> res </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword control-flow">await</span><span class="token plain"> </span><span class="token maybe-class-name">Orders</span><span class="token punctuation">.</span><span class="token method function property-access">deleteOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain">_id</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">23</span><span class="table-cell"><span class="token plain">    </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">24</span><span class="table-cell"><span class="token plain">      </span><span class="token literal-property property">found</span><span class="token operator">:</span><span class="token plain"> res</span><span class="token punctuation">.</span><span class="token property-access">n</span><span class="token punctuation">,</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">25</span><span class="table-cell"><span class="token plain">      </span><span class="token literal-property property">deleted</span><span class="token operator">:</span><span class="token plain"> res</span><span class="token punctuation">.</span><span class="token property-access">deletedCount</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">26</span><span class="table-cell"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">27</span><span class="table-cell"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">28</span><span class="table-cell"><span class="token plain">  </span><span class="token keyword">async</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">_filter</span><span class="token parameter punctuation">,</span><span class="token parameter"> _options </span><span class="token parameter operator">=</span><span class="token parameter"> </span><span class="token parameter punctuation">{</span><span class="token parameter punctuation">}</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">29</span><span class="table-cell"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain">populate</span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> _options</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">30</span><span class="table-cell"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> query </span><span class="token operator">=</span><span class="token plain"> </span><span class="token maybe-class-name">Orders</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token plain">_filter</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">31</span><span class="table-cell"><span class="token plain">    </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">populate</span><span class="token punctuation">)</span><span class="token plain"> _</span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token plain">populate </span><span class="token operator">||</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">p</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> query</span><span class="token punctuation">.</span><span class="token method function property-access">populate</span><span class="token punctuation">(</span><span class="token plain">p</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">32</span><span class="table-cell"><span class="token plain">    </span><span class="token keyword control-flow">return</span><span class="token plain"> query</span><span class="token punctuation">.</span><span class="token method function property-access">lean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">33</span><span class="table-cell"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">34</span><span class="table-cell"><span class="token plain">  </span><span class="token keyword">async</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">aggregate</span><span class="token punctuation">(</span><span class="token parameter">pipeline </span><span class="token parameter operator">=</span><span class="token parameter"> </span><span class="token parameter punctuation">[</span><span class="token parameter punctuation">]</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">35</span><span class="table-cell"><span class="token plain">    </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token maybe-class-name">Orders</span><span class="token punctuation">.</span><span class="token method function property-access">aggregate</span><span class="token punctuation">(</span><span class="token plain">pipeline</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">36</span><span class="table-cell"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">37</span><span class="table-cell"><span class="token plain">  </span><span class="token keyword">async</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">paginate</span><span class="token punctuation">(</span><span class="token parameter">_query</span><span class="token parameter punctuation">,</span><span class="token parameter"> _options</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">38</span><span class="table-cell"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain">sort</span><span class="token punctuation">,</span><span class="token plain"> populate</span><span class="token punctuation">,</span><span class="token plain"> page</span><span class="token punctuation">,</span><span class="token plain"> limit</span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> _options</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">39</span><span class="table-cell"><span class="token plain">    </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token maybe-class-name">Orders</span><span class="token punctuation">.</span><span class="token method function property-access">paginate</span><span class="token punctuation">(</span><span class="token plain">_query</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">40</span><span class="table-cell"><span class="token plain">      sort</span><span class="token punctuation">,</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">41</span><span class="table-cell"><span class="token plain">      </span><span class="token literal-property property">lean</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">42</span><span class="table-cell"><span class="token plain">      page</span><span class="token punctuation">,</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">43</span><span class="table-cell"><span class="token plain">      limit</span><span class="token punctuation">,</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">44</span><span class="table-cell"><span class="token plain">      populate</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">45</span><span class="table-cell"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">46</span><span class="table-cell"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">47</span><span class="table-cell"><span class="token plain">  </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">freeze</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">48</span><span class="table-cell"><span class="token plain">    findOne</span><span class="token punctuation">,</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">49</span><span class="table-cell"><span class="token plain">    insert</span><span class="token punctuation">,</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">50</span><span class="table-cell"><span class="token plain">    update</span><span class="token punctuation">,</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">51</span><span class="table-cell"><span class="token plain">    remove</span><span class="token punctuation">,</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">52</span><span class="table-cell"><span class="token plain">    find</span><span class="token punctuation">,</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">53</span><span class="table-cell"><span class="token plain">    aggregate</span><span class="token punctuation">,</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">54</span><span class="table-cell"><span class="token plain">    paginate</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">55</span><span class="table-cell"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">56</span><span class="table-cell"><span class="token plain"></span><span class="token punctuation">}</span></span></div></div></pre></p><p class="mb-4">Several of these files would then be exported in their <span class="inline bg-gray-50 px-1 py-0.5 text-sm border border-gray-200 font-jetbrains">index.js</span> like follows:</p><p class="mb-4"><pre class="prism-code language-javascript relative w-full mb-7 mt-3 text-left"><div class="absolute top-0 right-0 bg-gray-50 p-1 text-xs border border-gray-200 font-jetbrains text-gray-600 flex flex-row"><span>javascript</span><span class="mx-2 text-gray-300">|</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="h-4 w-4"><path stroke-linecap="round" stroke-linejoin="round" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"></path></svg></div><div class="p-2 shadow-sm border border-gray-200 text-sm font-jetbrains w-full overflow-x-auto"><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">1</span><span class="table-cell"><span class="token comment">// /data-access/index.js</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">2</span><span class="table-cell"><span class="token plain">
</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">3</span><span class="table-cell"><span class="token plain"></span><span class="token comment">// your DB model definitions, in OneFood's case they are Mongoose files</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">4</span><span class="table-cell"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports operator">*</span><span class="token imports"> </span><span class="token imports keyword module">as</span><span class="token imports"> models</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">"../models"</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">5</span><span class="table-cell"><span class="token plain">
</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">6</span><span class="table-cell"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports">makeOrdersDb</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">"./orders.db"</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">7</span><span class="table-cell"><span class="token plain">
</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">8</span><span class="table-cell"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> ordersDb </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">makeOrdersDb</span><span class="token punctuation">(</span><span class="token plain">models</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">9</span><span class="table-cell"><span class="token plain">
</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">10</span><span class="table-cell"><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token exports punctuation">{</span><span class="token exports"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">11</span><span class="table-cell"><span class="token exports">  ordersDb</span><span class="token exports punctuation">,</span><span class="token exports"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">12</span><span class="table-cell"><span class="token exports">  </span><span class="token exports spread operator">...</span><span class="token exports"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">13</span><span class="table-cell"><span class="token exports"></span><span class="token exports punctuation">}</span><span class="token punctuation">;</span></span></div></div></pre></p><p class="mb-4">As you can see we are making the <span class="inline bg-gray-50 px-1 py-0.5 text-sm border border-gray-200 font-jetbrains">models</span> available to their abstraction layer through <i>Dependency Injection</i>. Somewhere upstream, we have some code that will call the `<pre class="inline"><code class="nohighlight">ordersDb.findOne()</code></pre>` function and all the various dependencies required (i.e., `models`) will be automatically available.</p><p class="mb-4">Dependency Injection has several advantages described below:</p><ul class="list-disc list-inside mb-8"><li class="mb-1">The first advantage is <i>Testability</i>. By injecting dependencies, we can test our code independently of anything else.</li><li class="mb-1">The other advantage is as the developer is writing this code, they do not need all of these dependencies to be ready. In this case, the developer can focus on the business logic of the <i>Entity</i>.</li><li class="mb-1">The most important advantage of doing this is that the developer can change the implementation details of the project dependencies independently of this code.</li></ul><h2 id="2_use_cases" class="h2 text-gray-900 mb-4 mt-10 scroll-mt-24">2. Use Cases</h2><p class="mb-4">The <i>Use Cases </i>layer, which lies outside the <i>Entities</i> layer, contains login and rules related to the behavior and design of the system.</p><p class="mb-4">In simple words, <strong class="font-semibold text-lg">Use Cases are interactions between Entities</strong>. For example, suppose we are in our Social Media application example. In that case, we can have a <i>Use Case</i> like user posts, or in the OneFood application, a customer places an order.</p><p class="mb-4">Changes to this layer should not affect the entities. Changes to externalities such as the database, user interface, or frameworks are unlikely to affect this layer.</p><p class="mb-4">Let us check out the <span class="inline bg-gray-50 px-1 py-0.5 text-sm border border-gray-200 font-jetbrains">/use-cases</span> directory and look at the Order's definition:</p><p class="mb-4"><pre class="prism-code language-javascript relative w-full mb-7 mt-3 text-left"><div class="absolute top-0 right-0 bg-gray-50 p-1 text-xs border border-gray-200 font-jetbrains text-gray-600 flex flex-row"><span>javascript</span><span class="mx-2 text-gray-300">|</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="h-4 w-4"><path stroke-linecap="round" stroke-linejoin="round" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"></path></svg></div><div class="p-2 shadow-sm border border-gray-200 text-sm font-jetbrains w-full overflow-x-auto"><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">1</span><span class="table-cell"><span class="token comment">// /use-cases/orders/post-order.js</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">2</span><span class="table-cell"><span class="token plain">
</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">3</span><span class="table-cell"><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword module">default</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">makePostOrder</span><span class="token punctuation">(</span><span class="token parameter punctuation">{</span><span class="token parameter"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">4</span><span class="table-cell"><span class="token parameter">  ordersDb</span><span class="token parameter punctuation">,</span><span class="token parameter"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">5</span><span class="table-cell"><span class="token parameter">  orderItemsDb</span><span class="token parameter punctuation">,</span><span class="token parameter"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">6</span><span class="table-cell"><span class="token parameter">  getPromoCodeDetails</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">7</span><span class="table-cell"><span class="token parameter"></span><span class="token parameter punctuation">}</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">8</span><span class="table-cell"><span class="token plain">  </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token keyword">async</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">postOrder</span><span class="token punctuation">(</span><span class="token parameter punctuation">{</span><span class="token parameter">body</span><span class="token parameter punctuation">,</span><span class="token parameter"> headers</span><span class="token parameter punctuation">,</span><span class="token parameter"> user</span><span class="token parameter punctuation">}</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">9</span><span class="table-cell"><span class="token plain">    </span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">10</span><span class="table-cell"><span class="token plain">    </span><span class="token comment">// Validate parameters...</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">11</span><span class="table-cell"><span class="token plain">    </span><span class="token comment">// Create order...</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">12</span><span class="table-cell"><span class="token plain">    </span><span class="token comment">// Create order items...</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">13</span><span class="table-cell"><span class="token plain">
</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">14</span><span class="table-cell"><span class="token plain">    </span><span class="token keyword control-flow">return</span><span class="token plain"> order</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">15</span><span class="table-cell"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">16</span><span class="table-cell"><span class="token plain"></span><span class="token punctuation">}</span></span></div></div></pre></p><p class="mb-4">All Orders <i>Use Cases</i> can then be exported like this:</p><p class="mb-4"><pre class="prism-code language-javascript relative w-full mb-7 mt-3 text-left"><div class="absolute top-0 right-0 bg-gray-50 p-1 text-xs border border-gray-200 font-jetbrains text-gray-600 flex flex-row"><span>javascript</span><span class="mx-2 text-gray-300">|</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="h-4 w-4"><path stroke-linecap="round" stroke-linejoin="round" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"></path></svg></div><div class="p-2 shadow-sm border border-gray-200 text-sm font-jetbrains w-full overflow-x-auto"><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">1</span><span class="table-cell"><span class="token comment">// /use-cases/orders/index.js</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">2</span><span class="table-cell"><span class="token plain">
</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">3</span><span class="table-cell"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">4</span><span class="table-cell"><span class="token plain">  ordersDb</span><span class="token punctuation">,</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">5</span><span class="table-cell"><span class="token plain">  </span><span class="token comment">// ...</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">6</span><span class="table-cell"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">'data-access'</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">7</span><span class="table-cell"><span class="token plain">
</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">8</span><span class="table-cell"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">Config</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">'config'</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">9</span><span class="table-cell"><span class="token plain">
</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">10</span><span class="table-cell"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports">makePostOrder</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">'./post-order'</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">11</span><span class="table-cell"><span class="token plain"></span><span class="token comment">// ...</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">12</span><span class="table-cell"><span class="token plain">
</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">13</span><span class="table-cell"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> postOrder </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">makePostOrder</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">14</span><span class="table-cell"><span class="token plain">  ordersDb</span><span class="token punctuation">,</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">15</span><span class="table-cell"><span class="token plain">  </span><span class="token maybe-class-name">Config</span><span class="token punctuation">,</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">16</span><span class="table-cell"><span class="token plain">  </span><span class="token comment">// other injected dependencies ...</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">17</span><span class="table-cell"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">18</span><span class="table-cell"><span class="token plain">
</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">19</span><span class="table-cell"><span class="token plain"></span><span class="token comment">// Export a service containing all Use Cases ...</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">20</span><span class="table-cell"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> orderService </span><span class="token operator">=</span><span class="token plain"> </span><span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">freeze</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">21</span><span class="table-cell"><span class="token plain">  postOrder</span><span class="token punctuation">,</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">22</span><span class="table-cell"><span class="token plain">  </span><span class="token comment">// ...</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">23</span><span class="table-cell"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">24</span><span class="table-cell"><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword module">default</span><span class="token plain"> orderService</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">25</span><span class="table-cell"><span class="token plain">
</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">26</span><span class="table-cell"><span class="token plain"></span><span class="token comment">// ... and also every Use Case singularly</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">27</span><span class="table-cell"><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">28</span><span class="table-cell"><span class="token plain">  postOrder</span><span class="token punctuation">,</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">29</span><span class="table-cell"><span class="token plain">  </span><span class="token comment">// ...</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">30</span><span class="table-cell"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span></span></div></div></pre></p><h2 id="3_interface_adapters" class="h2 text-gray-900 mb-4 mt-10 scroll-mt-24">3. Interface Adapters</h2><p class="mb-4">The Interface Adapters or the Adapter layer holds the controllers, APIs, and gateways. The Interface Adapters govern the flow of communication between external components and the system's back-end.</p><p class="mb-4">In simple words, <strong class="font-semibold text-lg">Interface Adapters are isolating our various Use Cases from the tools that we use</strong>.&nbsp;</p><p class="mb-4">Let us look at the controllers directory and choose <span class="inline bg-gray-50 px-1 py-0.5 text-sm border border-gray-200 font-jetbrains">OrderController</span> by sample to see what's going on:

<pre class="prism-code language-javascript relative w-full mb-7 mt-3 text-left"><div class="absolute top-0 right-0 bg-gray-50 p-1 text-xs border border-gray-200 font-jetbrains text-gray-600 flex flex-row"><span>javascript</span><span class="mx-2 text-gray-300">|</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="h-4 w-4"><path stroke-linecap="round" stroke-linejoin="round" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"></path></svg></div><div class="p-2 shadow-sm border border-gray-200 text-sm font-jetbrains w-full overflow-x-auto"><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">1</span><span class="table-cell"><span class="token comment">// /controllers/order.controller.js</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">2</span><span class="table-cell"><span class="token plain">
</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">3</span><span class="table-cell"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">4</span><span class="table-cell"><span class="token plain">  postOrder</span><span class="token punctuation">,</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">5</span><span class="table-cell"><span class="token plain">  </span><span class="token comment">// ...</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">6</span><span class="table-cell"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">'use-cases/orders'</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">7</span><span class="table-cell"><span class="token plain">
</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">8</span><span class="table-cell"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports punctuation">{</span><span class="token imports"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">9</span><span class="table-cell"><span class="token imports">  postPaymentLink</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">10</span><span class="table-cell"><span class="token imports"></span><span class="token imports punctuation">}</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">'use-cases/payments'</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">11</span><span class="table-cell"><span class="token plain">
</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">12</span><span class="table-cell"><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword module">default</span><span class="token plain"> </span><span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">freeze</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">13</span><span class="table-cell"><span class="token plain">  </span><span class="token function-variable function">postOrder</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">httpRequest</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token function">postOrder</span><span class="token punctuation">(</span><span class="token plain">httpRequest</span><span class="token punctuation">,</span><span class="token plain"> postPaymentLink</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">14</span><span class="table-cell"><span class="token plain">  </span><span class="token comment">// ...</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">15</span><span class="table-cell"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></div></div></pre></p><h2 id="4_routes" class="h2 text-gray-900 mb-4 mt-10 scroll-mt-24">4. Routes</h2><p class="mb-4">The <span class="inline bg-gray-50 px-1 py-0.5 text-sm border border-gray-200 font-jetbrains">/routes</span> folder is where you can organize all of your different REST endpoints declarations. The file below exposes all available endpoints related to the <span class="inline bg-gray-50 px-1 py-0.5 text-sm border border-gray-200 font-jetbrains">Orders</span> <i>Entity</i>:</p><p class="mb-4"><pre class="prism-code language-javascript relative w-full mb-7 mt-3 text-left"><div class="absolute top-0 right-0 bg-gray-50 p-1 text-xs border border-gray-200 font-jetbrains text-gray-600 flex flex-row"><span>javascript</span><span class="mx-2 text-gray-300">|</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="h-4 w-4"><path stroke-linecap="round" stroke-linejoin="round" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"></path></svg></div><div class="p-2 shadow-sm border border-gray-200 text-sm font-jetbrains w-full overflow-x-auto"><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">1</span><span class="table-cell"><span class="token comment">// /routes/order.routes.js</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">2</span><span class="table-cell"><span class="token plain">
</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">3</span><span class="table-cell"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports">express</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">'express'</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">4</span><span class="table-cell"><span class="token plain">
</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">5</span><span class="table-cell"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports">controller</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">'controllers/api/orderController'</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">6</span><span class="table-cell"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports">makeExpressCallback</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">'routes/make-callback'</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">7</span><span class="table-cell"><span class="token plain">
</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">8</span><span class="table-cell"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> router </span><span class="token operator">=</span><span class="token plain"> express</span><span class="token punctuation">.</span><span class="token method function property-access maybe-class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">9</span><span class="table-cell"><span class="token plain">
</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">10</span><span class="table-cell"><span class="token plain">router</span><span class="token punctuation">.</span><span class="token method function property-access">route</span><span class="token punctuation">(</span><span class="token string">'/order'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token function">makeExpressCallback</span><span class="token punctuation">(</span><span class="token plain">controller</span><span class="token punctuation">.</span><span class="token property-access">postOrder</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">11</span><span class="table-cell"><span class="token plain">router</span><span class="token punctuation">.</span><span class="token method function property-access">route</span><span class="token punctuation">(</span><span class="token string">'/order/:orderId'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token function">makeExpressCallback</span><span class="token punctuation">(</span><span class="token plain">controller</span><span class="token punctuation">.</span><span class="token property-access">getOrderById</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">12</span><span class="table-cell"><span class="token plain"></span><span class="token comment">// ...</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">13</span><span class="table-cell"><span class="token plain">
</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">14</span><span class="table-cell"><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword module">default</span><span class="token plain"> router</span><span class="token punctuation">;</span></span></div></div></pre></p><p class="mb-4"><strong class="font-semibold text-lg">Bonus</strong>: you may have noticed the <span class="inline bg-gray-50 px-1 py-0.5 text-sm border border-gray-200 font-jetbrains">makeExpressCallback</span> function in the code. That is a wrapper function that:</p><ul class="list-disc list-inside mb-8"><li class="mb-1">receives <span class="inline bg-gray-50 px-1 py-0.5 text-sm border border-gray-200 font-jetbrains">req</span> and <span class="inline bg-gray-50 px-1 py-0.5 text-sm border border-gray-200 font-jetbrains">res</span> as inputs from Express's <span class="inline bg-gray-50 px-1 py-0.5 text-sm border border-gray-200 font-jetbrains">.post()</span>, <span class="inline bg-gray-50 px-1 py-0.5 text-sm border border-gray-200 font-jetbrains">.get()</span>, etc. functions of each endpoint.</li><li class="mb-1">creates a clean request object with all possible useful information needed by controllers and feeds them with it (i.e., <span class="inline bg-gray-50 px-1 py-0.5 text-sm border border-gray-200 font-jetbrains">controller.postOrder</span>);</li><li class="mb-1">handles whatever it's returned by controllers (i.e., data or errors), and replied to clients in a standardized way.</li></ul><p class="mb-4">Check this file out:</p><p class="mb-4"> <pre class="prism-code language-javascript relative w-full mb-7 mt-3 text-left"><div class="absolute top-0 right-0 bg-gray-50 p-1 text-xs border border-gray-200 font-jetbrains text-gray-600 flex flex-row"><span>javascript</span><span class="mx-2 text-gray-300">|</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="h-4 w-4"><path stroke-linecap="round" stroke-linejoin="round" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"></path></svg></div><div class="p-2 shadow-sm border border-gray-200 text-sm font-jetbrains w-full overflow-x-auto"><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">1</span><span class="table-cell"><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports operator">*</span><span class="token imports"> </span><span class="token imports keyword module">as</span><span class="token imports"> </span><span class="token imports maybe-class-name">Sentry</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">'@sentry/node'</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">2</span><span class="table-cell"><span class="token plain">
</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">3</span><span class="table-cell"><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword module">default</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">controller</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">req</span><span class="token parameter punctuation">,</span><span class="token parameter"> res</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">4</span><span class="table-cell"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> httpRequest </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">5</span><span class="table-cell"><span class="token plain">    </span><span class="token literal-property property">body</span><span class="token operator">:</span><span class="token plain"> req</span><span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">,</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">6</span><span class="table-cell"><span class="token plain">    </span><span class="token literal-property property">query</span><span class="token operator">:</span><span class="token plain"> req</span><span class="token punctuation">.</span><span class="token property-access">query</span><span class="token punctuation">,</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">7</span><span class="table-cell"><span class="token plain">    </span><span class="token literal-property property">params</span><span class="token operator">:</span><span class="token plain"> req</span><span class="token punctuation">.</span><span class="token property-access">params</span><span class="token punctuation">,</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">8</span><span class="table-cell"><span class="token plain">    </span><span class="token literal-property property">ip</span><span class="token operator">:</span><span class="token plain"> req</span><span class="token punctuation">.</span><span class="token property-access">ip</span><span class="token punctuation">,</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">9</span><span class="table-cell"><span class="token plain">    </span><span class="token literal-property property">method</span><span class="token operator">:</span><span class="token plain"> req</span><span class="token punctuation">.</span><span class="token property-access">method</span><span class="token punctuation">,</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">10</span><span class="table-cell"><span class="token plain">    </span><span class="token literal-property property">path</span><span class="token operator">:</span><span class="token plain"> req</span><span class="token punctuation">.</span><span class="token property-access">path</span><span class="token punctuation">,</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">11</span><span class="table-cell"><span class="token plain">    </span><span class="token literal-property property">user</span><span class="token operator">:</span><span class="token plain"> req</span><span class="token punctuation">.</span><span class="token property-access">user</span><span class="token punctuation">,</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">12</span><span class="table-cell"><span class="token plain">    </span><span class="token literal-property property">logger</span><span class="token operator">:</span><span class="token plain"> req</span><span class="token punctuation">.</span><span class="token property-access">logger</span><span class="token punctuation">,</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">13</span><span class="table-cell"><span class="token plain">    </span><span class="token literal-property property">source</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">14</span><span class="table-cell"><span class="token plain">      </span><span class="token literal-property property">ip</span><span class="token operator">:</span><span class="token plain"> req</span><span class="token punctuation">.</span><span class="token property-access">ip</span><span class="token punctuation">,</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">15</span><span class="table-cell"><span class="token plain">      </span><span class="token literal-property property">browser</span><span class="token operator">:</span><span class="token plain"> req</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'User-Agent'</span><span class="token punctuation">)</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">16</span><span class="table-cell"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">17</span><span class="table-cell"><span class="token plain">    </span><span class="token literal-property property">headers</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">18</span><span class="table-cell"><span class="token plain">      </span><span class="token string-property property">'Content-Type'</span><span class="token operator">:</span><span class="token plain"> req</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">19</span><span class="table-cell"><span class="token plain">      </span><span class="token literal-property property">Referer</span><span class="token operator">:</span><span class="token plain"> req</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'referer'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">20</span><span class="table-cell"><span class="token plain">      </span><span class="token string-property property">'User-Agent'</span><span class="token operator">:</span><span class="token plain"> req</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'User-Agent'</span><span class="token punctuation">)</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">21</span><span class="table-cell"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">22</span><span class="table-cell"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">23</span><span class="table-cell"><span class="token plain">
</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">24</span><span class="table-cell"><span class="token plain">  </span><span class="token comment">// req.user coming from 'policies/token.js',</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">25</span><span class="table-cell"><span class="token plain">  </span><span class="token comment">// after the JWT token is parsed</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">26</span><span class="table-cell"><span class="token plain">  </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">req</span><span class="token punctuation">.</span><span class="token property-access">user</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">27</span><span class="table-cell"><span class="token plain">    </span><span class="token maybe-class-name">Sentry</span><span class="token punctuation">.</span><span class="token method function property-access">setUser</span><span class="token punctuation">(</span><span class="token plain">req</span><span class="token punctuation">.</span><span class="token property-access">user</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">28</span><span class="table-cell"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword control-flow">else</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">29</span><span class="table-cell"><span class="token plain">    </span><span class="token maybe-class-name">Sentry</span><span class="token punctuation">.</span><span class="token method function property-access">configureScope</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">scope</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> scope</span><span class="token punctuation">.</span><span class="token method function property-access">setUser</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">30</span><span class="table-cell"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">31</span><span class="table-cell"><span class="token plain">
</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">32</span><span class="table-cell"><span class="token plain">  </span><span class="token function">controller</span><span class="token punctuation">(</span><span class="token plain">httpRequest</span><span class="token punctuation">)</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">33</span><span class="table-cell"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">httpResponse</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">34</span><span class="table-cell"><span class="token plain">      res</span><span class="token punctuation">.</span><span class="token method function property-access">set</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">'application/json'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">35</span><span class="table-cell"><span class="token plain">      res</span><span class="token punctuation">.</span><span class="token method function property-access">type</span><span class="token punctuation">(</span><span class="token string">'json'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">36</span><span class="table-cell"><span class="token plain">      </span><span class="token keyword">const</span><span class="token plain"> body </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">37</span><span class="table-cell"><span class="token plain">        </span><span class="token literal-property property">success</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">38</span><span class="table-cell"><span class="token plain">        </span><span class="token literal-property property">code</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">200</span><span class="token punctuation">,</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">39</span><span class="table-cell"><span class="token plain">        </span><span class="token literal-property property">data</span><span class="token operator">:</span><span class="token plain"> httpResponse</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">40</span><span class="table-cell"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">41</span><span class="table-cell"><span class="token plain">      res</span><span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token plain">body</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">42</span><span class="table-cell"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">43</span><span class="table-cell"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token keyword control-flow">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">44</span><span class="table-cell"><span class="token plain">      </span><span class="token maybe-class-name">Sentry</span><span class="token punctuation">.</span><span class="token method function property-access">captureException</span><span class="token punctuation">(</span><span class="token plain">e</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">45</span><span class="table-cell"><span class="token plain">      res</span><span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">46</span><span class="table-cell"><span class="token plain">        </span><span class="token literal-property property">success</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">47</span><span class="table-cell"><span class="token plain">        </span><span class="token literal-property property">code</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">400</span><span class="token punctuation">,</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">48</span><span class="table-cell"><span class="token plain">        </span><span class="token literal-property property">error</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">49</span><span class="table-cell"><span class="token plain">          </span><span class="token literal-property property">description</span><span class="token operator">:</span><span class="token plain"> e</span><span class="token punctuation">.</span><span class="token property-access">message</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">50</span><span class="table-cell"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">51</span><span class="table-cell"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">52</span><span class="table-cell"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">53</span><span class="table-cell"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span></span></div></div></pre></p><p class="mb-4">Then, let's export all routes:</p><p class="mb-4"><pre class="prism-code language-javascript relative w-full mb-7 mt-3 text-left"><div class="absolute top-0 right-0 bg-gray-50 p-1 text-xs border border-gray-200 font-jetbrains text-gray-600 flex flex-row"><span>javascript</span><span class="mx-2 text-gray-300">|</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="h-4 w-4"><path stroke-linecap="round" stroke-linejoin="round" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"></path></svg></div><div class="p-2 shadow-sm border border-gray-200 text-sm font-jetbrains w-full overflow-x-auto"><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">1</span><span class="table-cell"><span class="token comment">// /routes/index.js</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">2</span><span class="table-cell"><span class="token plain">
</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">3</span><span class="table-cell"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports">express</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">'express'</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">4</span><span class="table-cell"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports">token</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">'policies/token'</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">5</span><span class="table-cell"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports">orders</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">'./orders'</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">6</span><span class="table-cell"><span class="token plain"></span><span class="token comment">// ...</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">7</span><span class="table-cell"><span class="token plain">
</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">8</span><span class="table-cell"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> router </span><span class="token operator">=</span><span class="token plain"> express</span><span class="token punctuation">.</span><span class="token method function property-access maybe-class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">9</span><span class="table-cell"><span class="token plain">
</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">10</span><span class="table-cell"><span class="token plain"></span><span class="token comment">// Bonus: you can split this /routes folder in 2: private and public.</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">11</span><span class="table-cell"><span class="token plain"></span><span class="token comment">// In the private index.js file you would precede all routes declaration</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">12</span><span class="table-cell"><span class="token plain"></span><span class="token comment">// with a function that checks if the authentication token is present</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">13</span><span class="table-cell"><span class="token plain"></span><span class="token comment">// in all requests and it's valid.</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">14</span><span class="table-cell"><span class="token plain">router</span><span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token plain">token</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">15</span><span class="table-cell"><span class="token plain">router</span><span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token plain">orders</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">16</span><span class="table-cell"><span class="token plain">
</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">17</span><span class="table-cell"><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword module">default</span><span class="token plain"> router</span><span class="token punctuation">;</span></span></div></div></pre></p><h2 id="5_frameworks_and_drivers" class="h2 text-gray-900 mb-4 mt-10 scroll-mt-24">5. Frameworks and Drivers</h2><p class="mb-4">The Frameworks and Drivers, also known as the Infrastructure Layer, is the outermost layer that provides all necessary details about frameworks, drivers, and tools such as Databases that we use to build our application. All the details of the system go in this layer.</p><p class="mb-4">For example, in the case of the OneFood application, the engineering team used Express JS as the framework and Mongoose (MongoDB) for Node JS as the database framework.</p><p class="mb-4">The entry point to the entire application is the <span class="inline bg-gray-50 px-1 py-0.5 text-sm border border-gray-200 font-jetbrains">app.js</span> file. This is where we use the Express JS framework. You will see many <span class="inline bg-gray-50 px-1 py-0.5 text-sm border border-gray-200 font-jetbrains">import</span> statements, initialization of Express server, using the <span class="inline bg-gray-50 px-1 py-0.5 text-sm border border-gray-200 font-jetbrains">routes</span> middleware, and finally exporting the <span class="inline bg-gray-50 px-1 py-0.5 text-sm border border-gray-200 font-jetbrains">app</span> module.</p><p class="mb-4"><pre class="prism-code language-javascript relative w-full mb-7 mt-3 text-left"><div class="absolute top-0 right-0 bg-gray-50 p-1 text-xs border border-gray-200 font-jetbrains text-gray-600 flex flex-row"><span>javascript</span><span class="mx-2 text-gray-300">|</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="h-4 w-4"><path stroke-linecap="round" stroke-linejoin="round" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"></path></svg></div><div class="p-2 shadow-sm border border-gray-200 text-sm font-jetbrains w-full overflow-x-auto"><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">1</span><span class="table-cell"><span class="token comment">// app.js</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">2</span><span class="table-cell"><span class="token plain">
</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">3</span><span class="table-cell"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports">express</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">'express'</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">4</span><span class="table-cell"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports">routes</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">"routes"</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">5</span><span class="table-cell"><span class="token plain"></span><span class="token comment">// other imports</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">6</span><span class="table-cell"><span class="token plain">
</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">7</span><span class="table-cell"><span class="token plain"></span><span class="token comment">// initialize express server</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">8</span><span class="table-cell"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> app </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">9</span><span class="table-cell"><span class="token plain">
</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">10</span><span class="table-cell"><span class="token plain">app</span><span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span><span class="token plain"> routes</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">11</span><span class="table-cell"><span class="token plain">
</span></span></div><div class="table-row"><span class="table-cell text-right select-none opacity-50 pr-4">12</span><span class="table-cell"><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword module">default</span><span class="token plain"> app</span><span class="token punctuation">;</span></span></div></div></pre></p><h2 id="conclusion" class="h2 text-gray-900 mb-4 mt-10 scroll-mt-24">Conclusion</h2><p class="mb-4">Following these guidelines is simple and will save you from a lot of trouble in the future. By separating Software into layers and obeying the Dependency Rule, you will create Software that is more:</p><ul class="list-disc list-inside mb-8"><li class="mb-1">Testable</li><li class="mb-1">Maintainable</li><li class="mb-1">Independent of a framework</li><li class="mb-1">Independent of a database</li><li class="mb-1">Independent of UI</li><li class="mb-1">... and independent of any other tools and drivers</li></ul><p class="mb-4">Keep in mind that there's no boundary of having just four circles/layers. If you find that you may need more than four, just go on. However, the Dependency Rule must always apply.</p></div><div class="mt-8 bg-white p-4 sm:p-6 border border-yellow-300 sm:flex sm:items-start bg-yellow-50"><div class="mx-auto flex-shrink-0 flex items-center justify-center h-6 w-6 rounded-full sm:mx-0"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="h-6 w-6 text-yellow-400"><path stroke-linecap="round" stroke-linejoin="round" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div><div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left"><h3 class="text-lg leading-6 font-medium text-yellow-800">What do you think about this article?</h3><div class="mt-2"><p class="text-sm text-yellow-700">Whether it was helpful or not, we would love to hear your thoughts! Please leave a comment below.</p></div></div></div></div><div class="mt-12" style="grid-area: comments / comments / comments / comments;"><div><div id="disqus_thread"><iframe id="dsq-app6378" name="dsq-app6378" allowtransparency="true" frameborder="0" scrolling="no" tabindex="0" title="Disqus" width="100%" src="./Clean Architecture in ExpressJS Applications (NodeJS) _ Merlino Software Agency_files/saved_resource.html" style="width: 1px !important; min-width: 100% !important; border: none !important; overflow: hidden !important; height: 1428px !important;" horizontalscrolling="no" verticalscrolling="no"></iframe></div></div></div></article></div><footer class="bg-gray-50"><h2 id="footer-heading" class="sr-only">Footer</h2><div class="max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:py-16 lg:px-8"><div class="xl:grid xl:grid-cols-3 xl:gap-8"><div class="grid grid-cols-1 xl:gap-8 xl:col-span-2"><div class="md:grid md:grid-cols-1 gap-8"><div class="grid grid-cols-3 gap-8"><div class="col-span-3 sm:col-span-1"><h3 class="text-sm font-semibold text-gray-400 tracking-wider uppercase">Services</h3><ul role="list" class="mt-4 space-y-4"><li><a href="https://merlino.agency/#all-you-can-source" class="text-base text-gray-500 hover:text-gray-900">Mobile App Development</a></li><li><a href="https://merlino.agency/#all-you-can-source" class="text-base text-gray-500 hover:text-gray-900">Web App Development</a></li><li><a href="https://merlino.agency/#all-you-can-source" class="text-base text-gray-500 hover:text-gray-900">Desktop App Development</a></li><li><a href="https://merlino.agency/#all-you-can-source" class="text-base text-gray-500 hover:text-gray-900">Product Design &amp; Analytics</a></li><li><a href="https://merlino.agency/#all-you-can-source" class="text-base text-gray-500 hover:text-gray-900">Infrastructure &amp; Security</a></li><li><a href="https://merlino.agency/#all-you-can-source" class="text-base text-gray-500 hover:text-gray-900">Import, Export &amp; Sync</a></li><li><a href="https://merlino.agency/#all-you-can-source" class="text-base text-gray-500 hover:text-gray-900">Search Engine Optimization</a></li><li><a href="https://merlino.agency/#all-you-can-source" class="text-base text-gray-500 hover:text-gray-900">Minimum Viable Product</a></li></ul></div><div class="col-span-2 sm:col-span-1"><h3 class="text-sm font-semibold text-gray-400 tracking-wider uppercase">Projects</h3><ul role="list" class="mt-4 space-y-4"><li><a class="text-base text-gray-500 hover:text-gray-900" rel="noreferrer" href="https://merlino.agency/projects/onefood">OneFood<span class="text-gray-400 text-xs">(IT, DE, AT)</span></a></li><li><a href="https://trees-engineering.com/" target="_blank" class="text-base text-gray-500 hover:text-gray-900" rel="noreferrer">Trees Engineering <span class="text-gray-400 text-xs">(MY)</span></a></li><li><a href="https://trysmartbite.com/" target="_blank" class="text-base text-gray-500 hover:text-gray-900" rel="noreferrer">SmartBite <span class="text-gray-400 text-xs">(MY, SG, PH)</span></a></li><li><a href="https://beeinthebusiness.com/" target="_blank" class="text-base text-gray-500 hover:text-gray-900" rel="noreferrer">Bee <span class="text-gray-400 text-xs">(IT)</span></a></li></ul></div><div><h3 class="text-sm font-semibold text-gray-400 tracking-wider uppercase">Other</h3><ul role="list" class="mt-4 space-y-4"><li><a class="text-base text-gray-500 hover:text-gray-900" href="https://merlino.agency/careers">Careers</a></li><li><a class="text-base text-gray-500 hover:text-gray-900" href="https://merlino.agency/blog"><span class="mr-2">Blog</span><span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-pink-100 text-merlino-600">NEW</span></a></li></ul></div></div></div><div class="col-span-2 flex items-end mt-6 xl:mt-0"><div class="clutch-widget" data-url="https://widget.clutch.co" data-widget-type="2" data-height="45" data-clutchcompany-id="1879878"></div></div></div><div class="mt-8 xl:mt-0"><div id="revue-embed" class="bg-white shadow-sm border border-gray-300 p-4"><form action="https://www.getrevue.co/profile/romeo/add_subscriber" method="post" id="revue-form" name="revue-form" target="_blank" class="space-y-6"><div class="mb-2"><h4 class="mt-1 text-xl font-extrabold text-gray-900 sm:text-2xl sm:tracking-tight">Subscribe now to <span class="text-merlino-500">Merlin Coding</span></h4><p class="text-sm text-gray-500">Our weekly newsletter on what we learned this week at Merlino 🤓</p></div><div class="grid grid-cols-1 gap-6 sm:grid-cols-2"><div class="revue-form-group sm:col-span-2"><label for="member_email" class="m-label">Email address</label><input class="revue-form-field m-input mt-1" placeholder="" type="email" name="member[email]" id="member_email"></div><div class="revue-form-group"><div class="flex justify-between"><label for="member_first_name" class="m-label">First name</label><span id="phone_description" class="text-sm text-gray-500">Optional</span></div><input class="revue-form-field m-input mt-1" placeholder="" type="text" name="member[first_name]" id="member_first_name"></div><div class="revue-form-group"><div class="flex justify-between"><label for="member_last_name" class="m-label">Last name</label><span id="phone_description" class="text-sm text-gray-500">Optional</span></div><input class="revue-form-field m-input mt-1" placeholder="" type="text" name="member[last_name]" id="member_last_name"></div></div><div class="revue-form-actions"><input type="submit" name="member[subscribe]" id="member_submit" class="m-submit" value="Subscribe"></div><div class="revue-form-footer inline-block text-sm text-gray-500">By subscribing, you agree with Revue’s <a target="_blank" href="https://www.getrevue.co/terms" rel="noreferrer" class="text-merlino-400 hover:underline">Terms of Service</a> and <a target="_blank" href="https://www.getrevue.co/privacy" rel="noreferrer" class="text-merlino-400 hover:underline">Privacy Policy</a>. And no worries, we freaking hate spam as much as you do.</div></form></div></div></div><div class="mt-8 border-t border-gray-200 pt-8 md:flex md:items-center md:justify-between"><div class="flex space-x-6 md:order-2"><a href="https://merlino.agency/blog/clean-architecture-in-express-js-applications#" class="text-gray-400 hover:text-gray-500"><span class="sr-only">GitHub</span><svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd"></path></svg></a></div><p class="mt-8 text-base text-gray-400 md:mt-0 md:order-1">© 2022 Merlino Enterprise Sdn. Bhd. All rights reserved.</p></div></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"blog":{"metadata":{"tags":[{"sys":{"type":"Link","linkType":"Tag","id":"cleanArchitecture"}},{"sys":{"type":"Link","linkType":"Tag","id":"express"}},{"sys":{"type":"Link","linkType":"Tag","id":"javascript"}},{"sys":{"type":"Link","linkType":"Tag","id":"nodejs"}},{"sys":{"type":"Link","linkType":"Tag","id":"softwareArchitecture"}},{"sys":{"type":"Link","linkType":"Tag","id":"softwareEngineering"}}]},"sys":{"space":{"sys":{"type":"Link","linkType":"Space","id":"vsall43tabcn"}},"id":"2vMOPZbK5F05EN1SYZ6soU","type":"Entry","createdAt":"2021-12-12T10:17:20.582Z","updatedAt":"2022-12-06T16:19:51.472Z","environment":{"sys":{"id":"master","type":"Link","linkType":"Environment"}},"revision":108,"contentType":{"sys":{"type":"Link","linkType":"ContentType","id":"blogPost"}},"locale":"en-US"},"fields":{"banner":{"metadata":{"tags":[]},"sys":{"space":{"sys":{"type":"Link","linkType":"Space","id":"vsall43tabcn"}},"id":"2RZOrhQVLoPVOPT3sgV2Lf","type":"Asset","createdAt":"2021-12-12T13:15:53.195Z","updatedAt":"2021-12-12T13:37:54.272Z","environment":{"sys":{"id":"master","type":"Link","linkType":"Environment"}},"revision":2,"locale":"en-US"},"fields":{"title":"Clean Architecture in ExpressJS Applications","description":"","file":{"url":"//images.ctfassets.net/vsall43tabcn/2RZOrhQVLoPVOPT3sgV2Lf/68eaf4602453e37a7eedccc520ca2981/Clean_Architecture_in_ExpressJS_Applications.png","details":{"size":82814,"image":{"width":1600,"height":960}},"fileName":"Clean Architecture in ExpressJS Applications.png","contentType":"image/png"}}},"title":"Clean Architecture in ExpressJS Applications (NodeJS)","slug":"clean-architecture-in-express-js-applications","author":{"metadata":{"tags":[]},"sys":{"space":{"sys":{"type":"Link","linkType":"Space","id":"vsall43tabcn"}},"id":"1v0bsCQWqd4cijVSFrtbh2","type":"Entry","createdAt":"2021-09-14T07:18:28.420Z","updatedAt":"2021-12-03T12:50:19.325Z","environment":{"sys":{"id":"master","type":"Link","linkType":"Environment"}},"revision":4,"contentType":{"sys":{"type":"Link","linkType":"ContentType","id":"author"}},"locale":"en-US"},"fields":{"firstName":"Hassib","lastName":"Moddasser","avatar":{"metadata":{"tags":[]},"sys":{"space":{"sys":{"type":"Link","linkType":"Space","id":"vsall43tabcn"}},"id":"2839ymI0tbsIKDBy2lv0rG","type":"Asset","createdAt":"2021-11-29T21:37:18.430Z","updatedAt":"2021-11-29T21:37:18.430Z","environment":{"sys":{"id":"master","type":"Link","linkType":"Environment"}},"revision":1,"locale":"en-US"},"fields":{"title":"hassib","description":"","file":{"url":"//images.ctfassets.net/vsall43tabcn/2839ymI0tbsIKDBy2lv0rG/6f8f7227eb709138e745679294af300b/J4P9ISo6_400x400.jpg","details":{"size":26886,"image":{"width":400,"height":400}},"fileName":"J4P9ISo6_400x400.jpg","contentType":"image/jpeg"}}},"slug":"hassib-moddasser"}},"content":{"nodeType":"document","data":{},"content":[{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"I can't emphasize enough","marks":[{"type":"bold"}],"data":{}},{"nodeType":"text","value":" how learning and implementing the ","marks":[],"data":{}},{"nodeType":"text","value":"Clean Architecture","marks":[{"type":"italic"}],"data":{}},{"nodeType":"text","value":" in all our projects ","marks":[],"data":{}},{"nodeType":"text","value":"has saved—and is saving—us so much time","marks":[{"type":"bold"}],"data":{}},{"nodeType":"text","value":" in the ","marks":[],"data":{}},{"nodeType":"text","value":"development of new features","marks":[{"type":"italic"}],"data":{}},{"nodeType":"text","value":", the ","marks":[],"data":{}},{"nodeType":"text","value":"testability of the system","marks":[{"type":"italic"}],"data":{}},{"nodeType":"text","value":", and the ","marks":[],"data":{}},{"nodeType":"text","value":"general maintenance of their components","marks":[{"type":"italic"}],"data":{}},{"nodeType":"text","value":".","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Implementing it will require a little effort in understanding how it works and will also generate a bit more files than just following, for example, the ExpressJS Getting Started guide.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"However, we will never go back. It served us so robustly that we'll just keep focusing on shipping.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Now, let's start. ","marks":[],"data":{}}]},{"nodeType":"heading-2","data":{},"content":[{"nodeType":"text","value":"Introduction","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"The secret to building a large project that is easy to maintain and performs better is to separate files and classes into components that can change independently without affecting other components: this is what Clean Architecture is all about.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Clean Architecture is an architectural style created by ","marks":[],"data":{}},{"nodeType":"text","value":"Robert C. Martin","marks":[{"type":"italic"}],"data":{}},{"nodeType":"text","value":". It is a set of standards that aims to develop an application that makes it easier to quality code that will perform better, is easy to maintain, and has fewer dependencies as the project grows.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Firstly, I will introduce what Clean Architecture is. We will then head to the development side of things to see how the engineering team at ","marks":[],"data":{}},{"nodeType":"hyperlink","data":{"uri":"https://merlino.agency"},"content":[{"nodeType":"text","value":"Merlino Software Agency","marks":[],"data":{}}]},{"nodeType":"text","value":" developed","marks":[],"data":{}},{"nodeType":"text","value":" ","marks":[{"type":"bold"}],"data":{}},{"nodeType":"hyperlink","data":{"uri":"https://1-food.com"},"content":[{"nodeType":"text","value":"OneFood","marks":[{"type":"bold"}],"data":{}}]},{"nodeType":"text","value":" and ","marks":[],"data":{}},{"nodeType":"hyperlink","data":{"uri":"https://getisla.com"},"content":[{"nodeType":"text","value":"Isla","marks":[{"type":"bold"}],"data":{}}]},{"nodeType":"text","value":" using NodeJS/","marks":[],"data":{}},{"nodeType":"text","value":"ExpressJS","marks":[{"type":"bold"}],"data":{}},{"nodeType":"text","value":" with a Clean Architecture. In the end, we will conclude how Clean Architecture makes a difference.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"According to ","marks":[],"data":{}},{"nodeType":"hyperlink","data":{"uri":"https://insights.stackoverflow.com/survey/2021"},"content":[{"nodeType":"text","value":"Stack Overflow Insights of 2021","marks":[],"data":{}}]},{"nodeType":"text","value":", JavaScript completes its ninth year in a row as the most commonly used programming language. NodeJS is placed as the sixth most widely used tool, and Express JS, a minimal Node JS framework, got the third position as the most common web framework. Therefore, having your application in Express JS decorated with Clean Architecture is a blessing that leads to better performance and easy maintainability of the project.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Let us have a quick introduction to Software Architecture before diving into it!","marks":[],"data":{}}]},{"nodeType":"heading-2","data":{},"content":[{"nodeType":"text","value":"What is Software Architecture","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Before providing a definition, consider that the actions people may do using systems on a daily basis — scheduling a Tweet to post, sending an automated transactional email, etc. — heavily depend on the Software Architecture of the system in use.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Many things we know and use would be impossible without software architecture, but why is that?","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"A system's architecture acts as a blueprint. It establishes a communication and coordination mechanism among components, gives an abstraction to control system complexity, and represents the design decisions related to overall system structure and behavior.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"In simple words, ","marks":[],"data":{}},{"nodeType":"text","value":"Software Architecture exposes a system's structure while hiding implementation details","marks":[{"type":"bold"}],"data":{}},{"nodeType":"text","value":". Moreover,","marks":[],"data":{}},{"nodeType":"text","value":" it also focuses on how the elements and components within a system interact with one another","marks":[{"type":"bold"}],"data":{}},{"nodeType":"text","value":".","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"The subject of Software Architecture appears to have sparked much attention in recent years. Furthermore, among the many different types and styles, Clean Architecture attracted more attention than the others.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Let us head to the central part of the article and find out what Clean Architecture is.","marks":[],"data":{}}]},{"nodeType":"heading-2","data":{},"content":[{"nodeType":"text","value":"The Clean Architecture","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Microservices and serverless architecture have emerged as revolutionary architectural patterns in the software development world during the last several years. Each has its characteristics, behaviors, technological structure, and required expertise. However, they are all part of a broader desire for a better separation of architecture concerns and improved testability.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Clean Architecture is a set of standards that aims to develop layered architectures that make it easier to write quality code that will perform better, is easy to maintain, and has fewer dependencies as the project grows.","marks":[{"type":"bold"}],"data":{}},{"nodeType":"text","value":" This architecture can be applied no matter what language you code in.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"The illustration below shows the four concentric circles that compose a Clean Architecture, how they interact with each other, and their dependencies.","marks":[],"data":{}}]},{"nodeType":"embedded-asset-block","data":{"target":{"metadata":{"tags":[]},"sys":{"space":{"sys":{"type":"Link","linkType":"Space","id":"vsall43tabcn"}},"id":"gyZteBML1XipqwnZTPzRJ","type":"Asset","createdAt":"2021-12-08T11:03:31.956Z","updatedAt":"2021-12-08T11:03:31.956Z","environment":{"sys":{"id":"master","type":"Link","linkType":"Environment"}},"revision":1,"locale":"en-US"},"fields":{"title":"Robert C. Martin Clean Architecture Diagram","description":"","file":{"url":"//images.ctfassets.net/vsall43tabcn/gyZteBML1XipqwnZTPzRJ/0ad14b0e2271d7797e92791b66689ff3/Clean_Architecture.jpeg","details":{"size":107444,"image":{"width":772,"height":567}},"fileName":"Clean Architecture.jpeg","contentType":"image/jpeg"}}}},"content":[]},{"nodeType":"heading-2","data":{},"content":[{"nodeType":"text","value":"The Dependency Rule","marks":[],"data":{}}]},{"nodeType":"embedded-asset-block","data":{"target":{"metadata":{"tags":[]},"sys":{"space":{"sys":{"type":"Link","linkType":"Space","id":"vsall43tabcn"}},"id":"4CgiAa0sslHOzxoizCwTQd","type":"Asset","createdAt":"2021-12-12T10:37:56.638Z","updatedAt":"2021-12-12T10:37:56.638Z","environment":{"sys":{"id":"master","type":"Link","linkType":"Environment"}},"revision":1,"locale":"en-US"},"fields":{"title":"Clean Architecture Dependencies","description":"","file":{"url":"//images.ctfassets.net/vsall43tabcn/4CgiAa0sslHOzxoizCwTQd/0170d90c220101105b51630a2a7d13ba/Screenshot_2021-12-12_at_11.37.19.png","details":{"size":300136,"image":{"width":1200,"height":258}},"fileName":"Screenshot 2021-12-12 at 11.37.19.png","contentType":"image/png"}}}},"content":[]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"In the illustration above, please pay attention to the arrows, the fact that they are pointing from the outermost circle down into the innermost circle, and that they only go in one direction. The arrows represent the dependence flow, indicating that an outer ring can depend on an inner ring but that an inner ring cannot rely on an outer ring; this is what ","marks":[],"data":{}},{"nodeType":"text","value":"The Dependency Rule","marks":[{"type":"italic"}],"data":{}},{"nodeType":"text","value":" is all about.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"For example, ","marks":[],"data":{}},{"nodeType":"text","value":"Entities","marks":[{"type":"italic"}],"data":{}},{"nodeType":"text","value":" know nothing about all the other circles, while the ","marks":[],"data":{}},{"nodeType":"text","value":"Frameworks \u0026 Drivers","marks":[{"type":"italic"}],"data":{}},{"nodeType":"text","value":",","marks":[{"type":"bold"}],"data":{}},{"nodeType":"text","value":" the outer layer, know everything about the inner rings.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"In simple words, ","marks":[],"data":{}},{"nodeType":"text","value":"variables","marks":[{"type":"italic"}],"data":{}},{"nodeType":"text","value":", ","marks":[],"data":{}},{"nodeType":"text","value":"functions","marks":[{"type":"italic"}],"data":{}},{"nodeType":"text","value":", ","marks":[],"data":{}},{"nodeType":"text","value":"classes","marks":[{"type":"italic"}],"data":{}},{"nodeType":"text","value":", or any other named software entity declared in an outer circle must not be mentioned by the code in an inner circle.","marks":[],"data":{}}]},{"nodeType":"heading-2","data":{},"content":[{"nodeType":"text","value":"Four layers of Clean Architecture","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"There are four concentric circles in Clean Architecture that each represents different areas of Software, which are as below:","marks":[],"data":{}}]},{"nodeType":"ordered-list","data":{},"content":[{"nodeType":"list-item","data":{},"content":[{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Entities","marks":[],"data":{}}]}]},{"nodeType":"list-item","data":{},"content":[{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Use Cases","marks":[],"data":{}}]}]},{"nodeType":"list-item","data":{},"content":[{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Interface Adapters","marks":[],"data":{}}]}]},{"nodeType":"list-item","data":{},"content":[{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Frameworks and Drivers","marks":[],"data":{}}]}]}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"The development team of Merlino also implemented another layer called ","marks":[],"data":{}},{"nodeType":"text","value":"Routes","marks":[{"type":"italic"}],"data":{}},{"nodeType":"text","value":", and that's totally okay. If you find that you may need more than four, just go on. However, the ","marks":[],"data":{}},{"nodeType":"text","value":"Dependency Rule","marks":[{"type":"italic"}],"data":{}},{"nodeType":"text","value":" must always apply.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"So, the four layers become five layers in our case study, which are as below:","marks":[],"data":{}}]},{"nodeType":"ordered-list","data":{},"content":[{"nodeType":"list-item","data":{},"content":[{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Entities (Mongoose models and their abstraction)","marks":[],"data":{}}]}]},{"nodeType":"list-item","data":{},"content":[{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Use Cases","marks":[],"data":{}}]}]},{"nodeType":"list-item","data":{},"content":[{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Interface Adapters (Controllers)","marks":[],"data":{}}]}]},{"nodeType":"list-item","data":{},"content":[{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Routes","marks":[],"data":{}}]}]},{"nodeType":"list-item","data":{},"content":[{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Frameworks and Drivers","marks":[],"data":{}}]}]}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Let us find out what each circle means along with our case study, but before diving in, here is the project's hierarchy;","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"```plaintext\n.\n│   README.md\n│   package.json  \n│   ...   \n│\n└─── app\n│   │   app.js // 5. Framework and Drivers\n│   │   server.js // start master and forks other workers\n│   │   config.js // get config from env or config file\n│   │   database.js\n│   │   logger.js\n│   │\n│   └─── models // 1.a) entities (i.e., Mongoose models)\n│   │   │   index.js\n│   │   │   orders.model.js\n│   │   │   ...\n│   │\n│   └─── data-access // 1.b) entities (i.e., abstraction of Mongoose models)\n│   │   │   index.js\n│   │   │   orders.db.js\n│   │   │   ...\n│   │\n│   └─── use-cases // 2) Use cases\n│   │   └─── orders\n│   │   │   │   index.js\n│   │   │   │   post-order.js\n│   │   │   │   ...\n│   │   └─── ...\n│   │\n│   └─── controllers // 3) Interface Adapters\n│   │   │   order.controller.js\n│   │   │   ...\n│   │\n│   └─── routes // 4) Routes\n│   │   │   order.routes.js\n│   │   │   ...\n│   \n└─── ...\n```","marks":[{"type":"code"}],"data":{}}]},{"nodeType":"heading-2","data":{},"content":[{"nodeType":"text","value":"1. Entities","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"At the center of the onion are the Entities of the software, which constitute the business logic of software. An entity can be an object with methods, or it can be a set of data structures and functions, they don't know anything about the outer layers and don't have any dependency.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"In simple words, ","marks":[],"data":{}},{"nodeType":"text","value":"Entities are the primary concepts of your business","marks":[{"type":"bold"}],"data":{}},{"nodeType":"text","value":".","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"When something external happens, ","marks":[],"data":{}},{"nodeType":"text","value":"Entities","marks":[{"type":"italic"}],"data":{}},{"nodeType":"text","value":" are the least likely to change. A change to page navigation or security, for example, would not be expected to affect these objects. The entity circle should not be affected by any operational changes to any application.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"If you're building a Social Media application, you might have entities like ","marks":[],"data":{}},{"nodeType":"text","value":"Posts","marks":[{"type":"italic"}],"data":{}},{"nodeType":"text","value":", ","marks":[],"data":{}},{"nodeType":"text","value":"Comment","marks":[{"type":"italic"}],"data":{}},{"nodeType":"text","value":", or ","marks":[],"data":{}},{"nodeType":"text","value":"User","marks":[{"type":"italic"}],"data":{}},{"nodeType":"text","value":", or in the case of ","marks":[],"data":{}},{"nodeType":"hyperlink","data":{"uri":"https://1-food.com?utm_source=merlino_agency\u0026utm_medium=blog\u0026utm_campaign=clean_architecture"},"content":[{"nodeType":"text","value":"OneFood","marks":[],"data":{}}]},{"nodeType":"text","value":" — a premium food delivery business and a client of ours — a few of their entities would be ","marks":[],"data":{}},{"nodeType":"text","value":"Customer","marks":[{"type":"italic"}],"data":{}},{"nodeType":"text","value":", ","marks":[],"data":{}},{"nodeType":"text","value":"Order","marks":[{"type":"italic"}],"data":{}},{"nodeType":"text","value":", ","marks":[],"data":{}},{"nodeType":"text","value":"Payment","marks":[{"type":"italic"}],"data":{}},{"nodeType":"text","value":", ","marks":[],"data":{}},{"nodeType":"text","value":"Product","marks":[{"type":"italic"}],"data":{}},{"nodeType":"text","value":", ","marks":[],"data":{}},{"nodeType":"text","value":"Vendor","marks":[{"type":"italic"}],"data":{}},{"nodeType":"text","value":", etc.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Important to consider","marks":[{"type":"underline"}],"data":{}},{"nodeType":"text","value":" is that since we use ","marks":[],"data":{}},{"nodeType":"hyperlink","data":{"uri":"https://mongoosejs.com/docs/"},"content":[{"nodeType":"text","value":"Mongoose","marks":[],"data":{}}]},{"nodeType":"text","value":", we'll also have model definitions, which are specific to this implementation and we'll soon see how to abstract them. All models are then exported like follows:","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"All ","marks":[],"data":{}},{"nodeType":"text","value":"Entities","marks":[{"type":"italic"}],"data":{}},{"nodeType":"text","value":" can then be exported like this:","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"```javascript\n// /models/index.js\n\nimport Orders from './orders.model';\n// ...\n\nexport {\n  Orders,\n  // ...\n};\n```","marks":[{"type":"code"}],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Then, in `data-access`, let's create an abstraction layer that allows us to decouple the database methods that we call in our application (i.e., `findOne`, insert`, etc.) from the type of database, in this case, MongoDB. We might want to change to a SQL database in the future and that'll be totally fine. One could argue that this is what ","marks":[],"data":{}},{"nodeType":"hyperlink","data":{"uri":"https://www.prisma.io/"},"content":[{"nodeType":"text","value":"Prisma","marks":[],"data":{}}]},{"nodeType":"text","value":" does as a service.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"```javascript\n// /data-access/orders.db.js\n\n// outside libraries are ok to import\nimport {v4 as uuid} from \"uuid\";\nimport _ from \"lodash\";\n\nexport default function makeOrdersDb({Orders}) {\n  async function findOne(_filter, _options = {}) {\n    const {populate, sort} = _options;\n    const query = Orders.findOne(_filter);\n    if (sort) query.sort(sort);\n    _.forEach(populate || [], (p) =\u003e query.populate(p));\n    return query.lean().exec();\n  }\n  async function insert({id: _id = uuid(), ...orderInfo}) {\n    return Orders.create({_id, ...orderInfo});\n  }\n  async function update(_filter, _orderInfo) {\n    return Orders.findOneAndUpdate(_filter, _orderInfo, {new: true});\n  }\n  async function remove(_id) {\n    const res = await Orders.deleteOne({_id});\n    return {\n      found: res.n,\n      deleted: res.deletedCount\n    };\n  }\n  async function find(_filter, _options = {}) {\n    const {populate} = _options;\n    const query = Orders.find(_filter);\n    if (populate) _.forEach(populate || [], (p) =\u003e query.populate(p));\n    return query.lean().exec();\n  }\n  async function aggregate(pipeline = []) {\n    return Orders.aggregate(pipeline);\n  }\n  async function paginate(_query, _options) {\n    const {sort, populate, page, limit} = _options;\n    return Orders.paginate(_query, {\n      sort,\n      lean: true,\n      page,\n      limit,\n      populate\n    });\n  }\n  return Object.freeze({\n    findOne,\n    insert,\n    update,\n    remove,\n    find,\n    aggregate,\n    paginate\n  });\n}\n```","marks":[{"type":"code"}],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Several of these files would then be exported in their `index.js` like follows:","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"```javascript\n// /data-access/index.js\n\n// your DB model definitions, in OneFood's case they are Mongoose files\nimport * as models from \"../models\";\n\nimport makeOrdersDb from \"./orders.db\";\n\nconst ordersDb = makeOrdersDb(models);\n\nexport {\n  ordersDb,\n  ...\n};\n```","marks":[{"type":"code"}],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"As you can see we are making the `models` available to their abstraction layer through ","marks":[],"data":{}},{"nodeType":"text","value":"Dependency Injection","marks":[{"type":"italic"}],"data":{}},{"nodeType":"text","value":". Somewhere upstream, we have some code that will call the `","marks":[],"data":{}},{"nodeType":"text","value":"ordersDb.findOne()","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":"` function and all the various dependencies required (i.e., `models`) will be automatically available.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Dependency Injection has several advantages described below:","marks":[],"data":{}}]},{"nodeType":"unordered-list","data":{},"content":[{"nodeType":"list-item","data":{},"content":[{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"The first advantage is ","marks":[],"data":{}},{"nodeType":"text","value":"Testability","marks":[{"type":"italic"}],"data":{}},{"nodeType":"text","value":". By injecting dependencies, we can test our code independently of anything else.","marks":[],"data":{}}]}]},{"nodeType":"list-item","data":{},"content":[{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"The other advantage is as the developer is writing this code, they do not need all of these dependencies to be ready. In this case, the developer can focus on the business logic of the ","marks":[],"data":{}},{"nodeType":"text","value":"Entity","marks":[{"type":"italic"}],"data":{}},{"nodeType":"text","value":".","marks":[],"data":{}}]}]},{"nodeType":"list-item","data":{},"content":[{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"The most important advantage of doing this is that the developer can change the implementation details of the project dependencies independently of this code.","marks":[],"data":{}}]}]}]},{"nodeType":"heading-2","data":{},"content":[{"nodeType":"text","value":"2. Use Cases","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"The ","marks":[],"data":{}},{"nodeType":"text","value":"Use Cases ","marks":[{"type":"italic"}],"data":{}},{"nodeType":"text","value":"layer, which lies outside the ","marks":[],"data":{}},{"nodeType":"text","value":"Entities","marks":[{"type":"italic"}],"data":{}},{"nodeType":"text","value":" layer, contains login and rules related to the behavior and design of the system.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"In simple words, ","marks":[],"data":{}},{"nodeType":"text","value":"Use Cases are interactions between Entities","marks":[{"type":"bold"}],"data":{}},{"nodeType":"text","value":". For example, suppose we are in our Social Media application example. In that case, we can have a ","marks":[],"data":{}},{"nodeType":"text","value":"Use Case","marks":[{"type":"italic"}],"data":{}},{"nodeType":"text","value":" like user posts, or in the OneFood application, a customer places an order.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Changes to this layer should not affect the entities. Changes to externalities such as the database, user interface, or frameworks are unlikely to affect this layer.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Let us check out the `/use-cases` directory and look at the Order's definition:","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"```javascript\n// /use-cases/orders/post-order.js\n\nexport default function makePostOrder({\n  ordersDb,\n  orderItemsDb,\n  getPromoCodeDetails\n}) {\n  return async function postOrder({body, headers, user}) {\n    \n    // Validate parameters...\n    // Create order...\n    // Create order items...\n\n    return order;\n  };\n}\n```","marks":[{"type":"code"}],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"All Orders ","marks":[],"data":{}},{"nodeType":"text","value":"Use Cases","marks":[{"type":"italic"}],"data":{}},{"nodeType":"text","value":" can then be exported like this:","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"```javascript\n// /use-cases/orders/index.js\n\nimport {\n  ordersDb,\n  // ...\n} from 'data-access';\n\nimport Config from 'config';\n\nimport makePostOrder from './post-order';\n// ...\n\nconst postOrder = makePostOrder({\n  ordersDb,\n  Config,\n  // other injected dependencies ...\n});\n\n// Export a service containing all Use Cases ...\nconst orderService = Object.freeze({\n  postOrder,\n  // ...\n});\nexport default orderService;\n\n// ... and also every Use Case singularly\nexport {\n  postOrder,\n  // ...\n};\n```","marks":[{"type":"code"}],"data":{}}]},{"nodeType":"heading-2","data":{},"content":[{"nodeType":"text","value":"3. Interface Adapters","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"The Interface Adapters or the Adapter layer holds the controllers, APIs, and gateways. The Interface Adapters govern the flow of communication between external components and the system's back-end.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"In simple words, ","marks":[],"data":{}},{"nodeType":"text","value":"Interface Adapters are isolating our various Use Cases from the tools that we use","marks":[{"type":"bold"}],"data":{}},{"nodeType":"text","value":". ","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Let us look at the controllers directory and choose `OrderController` by sample to see what's going on:\n\n","marks":[],"data":{}},{"nodeType":"text","value":"```javascript\n// /controllers/order.controller.js\n\nimport {\n  postOrder,\n  // ...\n} from 'use-cases/orders';\n\nimport {\n  postPaymentLink\n} from 'use-cases/payments';\n\nexport default Object.freeze({\n  postOrder: (httpRequest) =\u003e postOrder(httpRequest, postPaymentLink),\n  // ...\n});\n```","marks":[{"type":"code"}],"data":{}}]},{"nodeType":"heading-2","data":{},"content":[{"nodeType":"text","value":"4. Routes","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"The `/routes` folder is where you can organize all of your different REST endpoints declarations. The file below exposes all available endpoints related to the `Orders` ","marks":[],"data":{}},{"nodeType":"text","value":"Entity","marks":[{"type":"italic"}],"data":{}},{"nodeType":"text","value":":","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"```javascript\n// /routes/order.routes.js\n\nimport express from 'express';\n\nimport controller from 'controllers/api/orderController';\nimport makeExpressCallback from 'routes/make-callback';\n\nconst router = express.Router();\n\nrouter.route('/order').post(makeExpressCallback(controller.postOrder));\nrouter.route('/order/:orderId').get(makeExpressCallback(controller.getOrderById));\n// ...\n\nexport default router;\n```","marks":[{"type":"code"}],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Bonus","marks":[{"type":"bold"}],"data":{}},{"nodeType":"text","value":": you may have noticed the `makeExpressCallback` function in the code. That is a wrapper function that:","marks":[],"data":{}}]},{"nodeType":"unordered-list","data":{},"content":[{"nodeType":"list-item","data":{},"content":[{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"receives `req` and `res` as inputs from Express's `.post()`, `.get()`, etc. functions of each endpoint.","marks":[],"data":{}}]}]},{"nodeType":"list-item","data":{},"content":[{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"creates a clean request object with all possible useful information needed by controllers and feeds them with it (i.e., `controller.postOrder`);","marks":[],"data":{}}]}]},{"nodeType":"list-item","data":{},"content":[{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"handles whatever it's returned by controllers (i.e., data or errors), and replied to clients in a standardized way.","marks":[],"data":{}}]}]}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Check this file out:","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":" ","marks":[],"data":{}},{"nodeType":"text","value":"```javascript\nimport * as Sentry from '@sentry/node';\n\nexport default (controller) =\u003e (req, res) =\u003e {\n  const httpRequest = {\n    body: req.body,\n    query: req.query,\n    params: req.params,\n    ip: req.ip,\n    method: req.method,\n    path: req.path,\n    user: req.user,\n    logger: req.logger,\n    source: {\n      ip: req.ip,\n      browser: req.get('User-Agent')\n    },\n    headers: {\n      'Content-Type': req.get('Content-Type'),\n      Referer: req.get('referer'),\n      'User-Agent': req.get('User-Agent')\n    }\n  };\n\n  // req.user coming from 'policies/token.js',\n  // after the JWT token is parsed\n  if (req.user) {\n    Sentry.setUser(req.user);\n  } else {\n    Sentry.configureScope((scope) =\u003e scope.setUser(null));\n  }\n\n  controller(httpRequest)\n    .then((httpResponse) =\u003e {\n      res.set('Content-Type', 'application/json');\n      res.type('json');\n      const body = {\n        success: true,\n        code: 200,\n        data: httpResponse\n      };\n      res.status(200).send(body);\n    })\n    .catch((e) =\u003e {\n      Sentry.captureException(e);\n      res.status(400).send({\n        success: false,\n        code: 400,\n        error: {\n          description: e.message\n        }\n      });\n    });\n};\n```","marks":[{"type":"code"}],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Then, let's export all routes:","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"```javascript\n// /routes/index.js\n\nimport express from 'express';\nimport token from 'policies/token';\nimport orders from './orders';\n// ...\n\nconst router = express.Router();\n\n// Bonus: you can split this /routes folder in 2: private and public.\n// In the private index.js file you would precede all routes declaration\n// with a function that checks if the authentication token is present\n// in all requests and it's valid.\nrouter.use(token);\nrouter.use(orders);\n\nexport default router;\n```","marks":[{"type":"code"}],"data":{}}]},{"nodeType":"heading-2","data":{},"content":[{"nodeType":"text","value":"5. Frameworks and Drivers","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"The Frameworks and Drivers, also known as the Infrastructure Layer, is the outermost layer that provides all necessary details about frameworks, drivers, and tools such as Databases that we use to build our application. All the details of the system go in this layer.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"For example, in the case of the OneFood application, the engineering team used Express JS as the framework and Mongoose (MongoDB) for Node JS as the database framework.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"The entry point to the entire application is the `app.js` file. This is where we use the Express JS framework. You will see many `import` statements, initialization of Express server, using the `routes` middleware, and finally exporting the `app` module.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"```javascript\n// app.js\n\nimport express from 'express';\nimport routes from \"routes\";\n// other imports\n\n// initialize express server\nconst app = express();\n\napp.use(\"/\", routes);\n\nexport default app;\n```","marks":[{"type":"code"}],"data":{}}]},{"nodeType":"heading-2","data":{},"content":[{"nodeType":"text","value":"Conclusion","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Following these guidelines is simple and will save you from a lot of trouble in the future. By separating Software into layers and obeying the Dependency Rule, you will create Software that is more:","marks":[],"data":{}}]},{"nodeType":"unordered-list","data":{},"content":[{"nodeType":"list-item","data":{},"content":[{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Testable","marks":[],"data":{}}]}]},{"nodeType":"list-item","data":{},"content":[{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Maintainable","marks":[],"data":{}}]}]},{"nodeType":"list-item","data":{},"content":[{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Independent of a framework","marks":[],"data":{}}]}]},{"nodeType":"list-item","data":{},"content":[{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Independent of a database","marks":[],"data":{}}]}]},{"nodeType":"list-item","data":{},"content":[{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Independent of UI","marks":[],"data":{}}]}]},{"nodeType":"list-item","data":{},"content":[{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"... and independent of any other tools and drivers","marks":[],"data":{}}]}]}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Keep in mind that there's no boundary of having just four circles/layers. If you find that you may need more than four, just go on. However, the Dependency Rule must always apply.","marks":[],"data":{}}]}]}}}},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"clean-architecture-in-express-js-applications"},"buildId":"A9hd8IqGAb7uFMHH7jffJ","isFallback":false,"dynamicIds":[3944],"gsp":true,"scriptLoader":[]}</script><script async="" src="./Clean Architecture in ExpressJS Applications (NodeJS) _ Merlino Software Agency_files/embed.js.download" id="dsq-embed-scr"></script><next-route-announcer><p aria-live="assertive" id="__next-route-announcer__" role="alert" style="border: 0px; clip: rect(0px, 0px, 0px, 0px); height: 1px; margin: -1px; overflow: hidden; padding: 0px; position: absolute; width: 1px; white-space: nowrap; overflow-wrap: normal;"></p></next-route-announcer><iframe style="display: none;" src="./Clean Architecture in ExpressJS Applications (NodeJS) _ Merlino Software Agency_files/saved_resource(1).html"></iframe><script id="dl" data-nscript="lazyOnload">window.dataLayer = window.dataLayer || [];</script><script id="gtm" data-nscript="lazyOnload">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-WRFTGFN');</script><script src="./Clean Architecture in ExpressJS Applications (NodeJS) _ Merlino Software Agency_files/[slug]-4617adbb4cf828c5.js.download"></script><script src="./Clean Architecture in ExpressJS Applications (NodeJS) _ Merlino Software Agency_files/index-ae1d7a0d40a8a3f2.js.download"></script><script src="./Clean Architecture in ExpressJS Applications (NodeJS) _ Merlino Software Agency_files/careers-f50d9edbaefca5c3.js.download"></script><script src="./Clean Architecture in ExpressJS Applications (NodeJS) _ Merlino Software Agency_files/837-b441fddf33c91a37.js.download"></script><script src="./Clean Architecture in ExpressJS Applications (NodeJS) _ Merlino Software Agency_files/blog-00d3c84f00c17751.js.download"></script><script src="./Clean Architecture in ExpressJS Applications (NodeJS) _ Merlino Software Agency_files/contact-us-9f39f0a4acc96baf.js.download"></script></body></html>